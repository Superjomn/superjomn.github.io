<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet type=text/css href=/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/css/style.css><title>Superjomn's blog | Emacs essentials</title></head><body><div id=nav-border class=container><nav id=nav class="nav justify-content-center"><a class=nav-link href=/><i data-feather=home></i>
Home</a>
<a class=nav-link href=/posts/><i data-feather=pen-tool></i>
Posts</a>
<a class=nav-link href=/tags/><i data-feather=tag></i>
Tags</a>
<a class=nav-link href=/posts/about/><i data-feather=info></i>
About</a></nav></div><div class=container><main id=main><h1>Emacs essentials</h1><i data-feather=calendar></i> <time datetime=2022-10-15>Oct 15, 2022</time>
<span id=social></span><i data-feather=tag></i>
<a class="btn btn-sm btn-outline-dark tag-btn" href=tags/emacs>emacs</a><br><br><p>It is a steep learning curve to master Emacs lisp, there are mainly two issues in it from my experience</p><ol><li>the lisp syntax and functional programming</li><li>the fragmented methods and libraries</li></ol><p>For the 1st issue, it is easy to master the syntax after writing several programs and getting used to them, but for the 2nd one, one needs to take notes or remember something.</p><p>In this blog, I focus on the 2nd point and keep updating the notes of some methods and libraries that I think are essential for writing Emacs lisp packages.</p><h2 id=builtin-methods>builtin methods</h2><h3 id=buffer>buffer</h3><h4 id=current-buffer-get-the-current-buffer>current-buffer: get the current buffer</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>current-buffer</span>)
</span></span></code></pre></div><h4 id=get-buffer-get-a-buffer-by-name>get-buffer: get a buffer by name</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>get-buffer</span> <span style=color:#e6db74>&#34;*scratch*&#34;</span>)
</span></span></code></pre></div><h4 id=get-buffer-create-create-the-buffer-if-not-exist>get-buffer-create: create the buffer if not exist</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>get-buffer-create</span> <span style=color:#e6db74>&#34;yaya&#34;</span>)
</span></span></code></pre></div><h4 id=changing-the-current-buffer>changing the current buffer</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(progn
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>set-buffer</span> (<span style=color:#a6e22e>get-buffer</span> <span style=color:#e6db74>&#34;*scratch*&#34;</span>))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>current-buffer</span>))
</span></span></code></pre></div><h4 id=changing-the-current-buffer-safely>Changing the current buffer safely</h4><p>It will return to the original buffer after the operation finished.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(progn
</span></span><span style=display:flex><span>  (save-current-buffer
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>set-buffer</span> <span style=color:#e6db74>&#34;*scratch*&#34;</span>)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>message</span> <span style=color:#e6db74>&#34;Current buffer: %s&#34;</span> (<span style=color:#a6e22e>current-buffer</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>current-buffer</span>))
</span></span></code></pre></div><h4 id=working-with-file-buffers>Working with file buffers</h4><p>To get the full file path for the file that the buffer represents</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>buffer-file-name</span>)
</span></span></code></pre></div><p>To find a buffer that represents a particular file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>get-file-buffer</span> <span style=color:#e6db74>&#34;/Users/yanchunwei/project/myblog2022/content-org/emacs-essentials.org&#34;</span>)
</span></span></code></pre></div><h4 id=loading-a-file-into-a-buffer-without-display-it>Loading a file into a buffer without display it</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(find-file-noselect <span style=color:#e6db74>&#34;xx.org&#34;</span>)
</span></span></code></pre></div><h4 id=get-all-buffer-names>Get all buffer names</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>mapcar</span> <span style=color:#a6e22e>#&#39;buffer-name</span> (<span style=color:#a6e22e>buffer-list</span>))
</span></span></code></pre></div><h3 id=point>point</h3><p>The &ldquo;point&rdquo; is the location of the cursor in the buffer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>point</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>point-max</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>point-min</span>)
</span></span></code></pre></div><h4 id=moving-the-point>Moving the point</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>goto-char</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>goto-char</span> (<span style=color:#a6e22e>point-max</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; goto the begining of the buffer</span>
</span></span><span style=display:flex><span>(beginning-of-buffer)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; goto the end of the buffer</span>
</span></span><span style=display:flex><span>(end-of-buffer)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>forward-char</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>forward-char</span> <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>forward-word</span>)
</span></span><span style=display:flex><span>(backward-word)
</span></span></code></pre></div><h4 id=preserving-the-point>Preserving the point</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(save-excursion
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>goto-char</span> (<span style=color:#a6e22e>point-max</span>))
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>point</span>)
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><h4 id=examining-buffer-text>Examining buffer text</h4><p>To look at text in the buffer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>char-after</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>char-after</span> (<span style=color:#a6e22e>point</span>))
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>char-after</span> (<span style=color:#a6e22e>point-min</span>))
</span></span></code></pre></div><h4 id=the-thing>The Thing</h4><p>The <code>thing-at-point</code> function is very useful for grabbing the text at the point if it matches a particular type of &ldquo;thing&rdquo;.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(thing-at-point <span style=color:#e6db74>&#39;word</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(thing-at-point <span style=color:#e6db74>&#39;sentence</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(thing-at-point <span style=color:#e6db74>&#39;sentence</span> <span style=color:#66d9ef>t</span>)
</span></span></code></pre></div><h4 id=serching-for-text>Serching for text</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>search-forward</span> <span style=color:#e6db74>&#34;thing&#34;</span>)
</span></span></code></pre></div><h4 id=inserting-text>Inserting text</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a6e22e>insert</span> <span style=color:#e6db74>&#34;000&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>insert</span> <span style=color:#e6db74>&#34;\n&#34;</span> <span style=color:#e6db74>&#34;This is&#34;</span> <span style=color:#e6db74>?\s</span> <span style=color:#e6db74>?\n</span> <span style=color:#e6db74>&#34;Sparta!&#34;</span>)
</span></span></code></pre></div><h4 id=deleting-text>Deleting text</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(with-current-buffer <span style=color:#e6db74>&#34;.gitignore&#34;</span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>delete-region</span> (<span style=color:#a6e22e>point</span>) (<span style=color:#a6e22e>point-max</span>)))
</span></span></code></pre></div><h4 id=saving-a-buffer>Saving a buffer</h4><p>To save the contents of a buffer back to the file it is associated with</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(save-buffer)
</span></span></code></pre></div><h2 id=modern-libraries>Modern libraries</h2><h3 id=ht-dot-el-for-hashtables>ht.el for hashtables</h3><p>Reference <a href=https://github.com/Wilfred/ht.el>ht.el</a> for more details.</p><h4 id=creating-a-hash-table>creating a hash table</h4><p>Create an empty hash table</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(let* ((the-dic (ht-create)))
</span></span><span style=display:flex><span>  the-dic
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><p>Create a hash table with initial records</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(let* ((the-dic (ht
</span></span><span style=display:flex><span>                 (<span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#e6db74>&#34;Tom&#34;</span>)
</span></span><span style=display:flex><span>                 (<span style=color:#e6db74>&#34;sex&#34;</span> <span style=color:#e6db74>&#39;male</span>))))
</span></span><span style=display:flex><span>  the-dic
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><h4 id=accessing-the-hash-table>accessing the hash table</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(let* ((the-dic (ht (<span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#e6db74>&#34;Tom&#34;</span>) (<span style=color:#e6db74>&#34;sex&#34;</span> <span style=color:#e6db74>&#39;male</span>))))
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; get a record</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; returns &#34;Tom&#34;</span>
</span></span><span style=display:flex><span>  (ht-get the-dic <span style=color:#e6db74>&#34;name&#34;</span>)
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><h4 id=iterating-over-the-hash-table>Iterating over the hash table</h4><p>Readonly mapping:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(let* ((the-dic (ht (<span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#e6db74>&#34;Tom&#34;</span>) (<span style=color:#e6db74>&#34;sex&#34;</span> <span style=color:#e6db74>&#39;male</span>) (<span style=color:#e6db74>&#34;age&#34;</span> <span style=color:#ae81ff>18</span>))))
</span></span><span style=display:flex><span>  (ht-map (lambda (key value) (<span style=color:#a6e22e>message</span> <span style=color:#e6db74>&#34;%S: %S&#34;</span> key value)) the-dic)
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><p>Mutable mapping:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(let* ((the-dic (ht (<span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#e6db74>&#34;Tom&#34;</span>) (<span style=color:#e6db74>&#34;sex&#34;</span> <span style=color:#e6db74>&#39;male</span>) (<span style=color:#e6db74>&#34;age&#34;</span> <span style=color:#ae81ff>18</span>))))
</span></span><span style=display:flex><span>  (ht-map (lambda (key value)
</span></span><span style=display:flex><span>            <span style=color:#75715e>;; modify the value if is string</span>
</span></span><span style=display:flex><span>            (setf value (if (<span style=color:#a6e22e>stringp</span> value)
</span></span><span style=display:flex><span>                            (<span style=color:#a6e22e>concat</span> <span style=color:#e6db74>&#34;modified &#34;</span> value)
</span></span><span style=display:flex><span>                          value))) the-dic))
</span></span></code></pre></div><p class="footer text-center">Copyright (c) 2023 Chunwei Yan</p></main></div><script src=/js/feather.min.js></script>
<script>feather.replace()</script></body></html>