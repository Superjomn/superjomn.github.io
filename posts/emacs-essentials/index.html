<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet type=text/css href=/css/bootstrap.min.css><link rel=stylesheet type=text/css href=/css/style.css><title>Superjomn's blog | Emacs essentials</title><meta name=google-site-verification content="kO2XszgjIr1OyaOubGpeb0M34ADBz27vyI1dLETarCM"></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z60BDN3JGH"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z60BDN3JGH")</script><body><div id=nav-border class=container><nav id=nav class="nav justify-content-center"><a class=nav-link href=/><i data-feather=home></i>
Home</a>
<a class=nav-link href=/posts/><i data-feather=pen-tool></i>
Posts</a>
<a class=nav-link href=/tags/><i data-feather=tag></i>
Tags</a>
<a class=nav-link href=/posts/about/><i data-feather=info></i>
About</a></nav></div><div class=container><main id=main><h1>Emacs essentials</h1><i data-feather=calendar></i> <time datetime=2022-10-15>Oct 15, 2022</time>
<span id=social></span><i data-feather=tag></i>
<a class="btn btn-sm btn-outline-dark tag-btn" href=tags/emacs>emacs</a><br><br><ul><li><a href=#builtin-methods>builtin methods</a><ul><li><a href=#buffer>buffer</a><ul><li><a href=#current-buffer-get-the-current-buffer>current-buffer: get the current buffer</a></li><li><a href=#get-buffer-get-a-buffer-by-name>get-buffer: get a buffer by name</a></li><li><a href=#get-buffer-create-create-the-buffer-if-not-exist>get-buffer-create: create the buffer if not exist</a></li><li><a href=#changing-the-current-buffer>changing the current buffer</a></li><li><a href=#goto-a-buffer>Goto a buffer</a></li><li><a href=#changing-the-current-buffer-safely>Changing the current buffer safely</a></li><li><a href=#working-with-file-buffers>Working with file buffers</a></li><li><a href=#loading-a-file-into-a-buffer-without-display-it>Loading a file into a buffer without display it</a></li><li><a href=#get-all-buffer-names>Get all buffer names</a></li></ul></li><li><a href=#point>point</a><ul><li><a href=#moving-the-point>Moving the point</a></li><li><a href=#preserving-the-point>Preserving the point</a></li><li><a href=#examining-buffer-text>Examining buffer text</a></li><li><a href=#the-thing>The Thing</a></li><li><a href=#serching-for-text>Serching for text</a></li><li><a href=#inserting-text>Inserting text</a></li><li><a href=#deleting-text>Deleting text</a></li><li><a href=#saving-a-buffer>Saving a buffer</a></li></ul></li><li><a href=#org-element>org-element</a></li><li><a href=#file-and-path>file and path</a><ul><li><a href=#get-the-path-of-the-current-file>Get the path of the current file</a></li><li><a href=#get-path-without-suffix>Get path without suffix</a></li><li><a href=#write-to-file>Write to file</a></li></ul></li><li><a href=#execute-shell-command>execute shell command</a></li></ul></li><li><a href=#modern-libraries>Modern libraries</a><ul><li><a href=#ht-dot-el-for-hashtables>ht.el for hashtables</a><ul><li><a href=#creating-a-hash-table>creating a hash table</a></li><li><a href=#accessing-the-hash-table>accessing the hash table</a></li><li><a href=#iterating-over-the-hash-table>Iterating over the hash table</a></li></ul></li></ul></li></ul><p>It is a steep learning curve to master Emacs lisp, there are mainly two issues in it from my experience</p><ol><li>the lisp syntax and functional programming</li><li>the fragmented methods and libraries</li></ol><p>For the 1st issue, it is easy to master the syntax after writing several programs and getting used to them, but for the 2nd one, one needs to take notes or remember something.</p><p>In this blog, I focus on the 2nd point and keep updating the notes of some methods and libraries that I think are essential for writing Emacs lisp packages.</p><h2 id=builtin-methods>builtin methods</h2><h3 id=buffer>buffer</h3><h4 id=current-buffer-get-the-current-buffer>current-buffer: get the current buffer</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>current-buffer</span>)
</span></span></code></pre></div><h4 id=get-buffer-get-a-buffer-by-name>get-buffer: get a buffer by name</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>get-buffer</span> <span style=color:#5a2>&#34;*scratch*&#34;</span>)
</span></span></code></pre></div><h4 id=get-buffer-create-create-the-buffer-if-not-exist>get-buffer-create: create the buffer if not exist</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>get-buffer-create</span> <span style=color:#5a2>&#34;yaya&#34;</span>)
</span></span></code></pre></div><h4 id=changing-the-current-buffer>changing the current buffer</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>progn</span>
</span></span><span style=display:flex><span>  (<span style=color:#000>set-buffer</span> (<span style=color:#000>get-buffer</span> <span style=color:#5a2>&#34;*scratch*&#34;</span>))
</span></span><span style=display:flex><span>  (<span style=color:#000>current-buffer</span>))
</span></span></code></pre></div><h4 id=goto-a-buffer>Goto a buffer</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>with-current-buffer</span> <span style=color:#5a2>&#34;*BUF*&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#888;font-style:italic>;; do something like progn</span>
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><h4 id=changing-the-current-buffer-safely>Changing the current buffer safely</h4><p>It will return to the original buffer after the operation finished.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>progn</span>
</span></span><span style=display:flex><span>  (<span style=color:#000>save-current-buffer</span>
</span></span><span style=display:flex><span>    (<span style=color:#000>set-buffer</span> <span style=color:#5a2>&#34;*scratch*&#34;</span>)
</span></span><span style=display:flex><span>    (<span style=color:#000>message</span> <span style=color:#5a2>&#34;Current buffer: %s&#34;</span> (<span style=color:#000>current-buffer</span>)))
</span></span><span style=display:flex><span>  (<span style=color:#000>current-buffer</span>))
</span></span></code></pre></div><h4 id=working-with-file-buffers>Working with file buffers</h4><p>To get the full file path for the file that the buffer represents</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>buffer-file-name</span>)
</span></span></code></pre></div><p>To find a buffer that represents a particular file</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>get-file-buffer</span> <span style=color:#5a2>&#34;/Users/yanchunwei/project/myblog2022/content-org/emacs-essentials.org&#34;</span>)
</span></span></code></pre></div><h4 id=loading-a-file-into-a-buffer-without-display-it>Loading a file into a buffer without display it</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>find-file-noselect</span> <span style=color:#5a2>&#34;xx.org&#34;</span>)
</span></span></code></pre></div><h4 id=get-all-buffer-names>Get all buffer names</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>mapcar</span> <span style=color:#000>#&#39;buffer-name</span> (<span style=color:#000>buffer-list</span>))
</span></span></code></pre></div><h3 id=point>point</h3><p>The &ldquo;point&rdquo; is the location of the cursor in the buffer.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>point</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>point-max</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>point-min</span>)
</span></span></code></pre></div><h4 id=moving-the-point>Moving the point</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>goto-char</span> <span style=color:#3af>1</span>)
</span></span><span style=display:flex><span>(<span style=color:#000>goto-char</span> (<span style=color:#000>point-max</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>;; goto the begining of the buffer</span>
</span></span><span style=display:flex><span>(<span style=color:#000>beginning-of-buffer</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>;; goto the end of the buffer</span>
</span></span><span style=display:flex><span>(<span style=color:#000>end-of-buffer</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#000>forward-char</span>)
</span></span><span style=display:flex><span>(<span style=color:#000>forward-char</span> <span style=color:#3af>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#000>forward-word</span>)
</span></span><span style=display:flex><span>(<span style=color:#000>backward-word</span>)
</span></span></code></pre></div><h4 id=preserving-the-point>Preserving the point</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>save-excursion</span>
</span></span><span style=display:flex><span>  (<span style=color:#000>goto-char</span> (<span style=color:#000>point-max</span>))
</span></span><span style=display:flex><span>  (<span style=color:#000>point</span>)
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><h4 id=examining-buffer-text>Examining buffer text</h4><p>To look at text in the buffer.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>char-after</span>)
</span></span><span style=display:flex><span>(<span style=color:#000>char-after</span> (<span style=color:#000>point</span>))
</span></span><span style=display:flex><span>(<span style=color:#000>char-after</span> (<span style=color:#000>point-min</span>))
</span></span></code></pre></div><h4 id=the-thing>The Thing</h4><p>The <code>thing-at-point</code> function is very useful for grabbing the text at the point if it matches a particular type of &ldquo;thing&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>thing-at-point</span> <span style=color:#5a2>&#39;word</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>thing-at-point</span> <span style=color:#5a2>&#39;sentence</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>thing-at-point</span> <span style=color:#5a2>&#39;sentence</span> <span style=color:#000>t</span>)
</span></span></code></pre></div><h4 id=serching-for-text>Serching for text</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>search-forward</span> <span style=color:#5a2>&#34;thing&#34;</span>)
</span></span></code></pre></div><h4 id=inserting-text>Inserting text</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>insert</span> <span style=color:#5a2>&#34;000&#34;</span>)
</span></span><span style=display:flex><span>(<span style=color:#000>insert</span> <span style=color:#5a2>&#34;\n&#34;</span> <span style=color:#5a2>&#34;This is&#34;</span> <span style=color:#5a2>?\s</span> <span style=color:#5a2>?\n</span> <span style=color:#5a2>&#34;Sparta!&#34;</span>)
</span></span></code></pre></div><h4 id=deleting-text>Deleting text</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>with-current-buffer</span> <span style=color:#5a2>&#34;.gitignore&#34;</span>
</span></span><span style=display:flex><span>  (<span style=color:#000>delete-region</span> (<span style=color:#000>point</span>) (<span style=color:#000>point-max</span>)))
</span></span></code></pre></div><h4 id=saving-a-buffer>Saving a buffer</h4><p>To save the contents of a buffer back to the file it is associated with</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>save-buffer</span>)
</span></span></code></pre></div><h3 id=org-element>org-element</h3><h3 id=file-and-path>file and path</h3><h4 id=get-the-path-of-the-current-file>Get the path of the current file</h4><p>The <code>buffer-file-name</code> is a buffer builtin variable holding the file name of the current buffer.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>file-truename</span> <span style=color:#000>buffer-file-name</span>)
</span></span></code></pre></div><h4 id=get-path-without-suffix>Get path without suffix</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>file-name-sans-extension</span> <span style=color:#5a2>&#34;/tmp/a.org&#34;</span>)
</span></span></code></pre></div><h4 id=write-to-file>Write to file</h4><p>Overwrite the content:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>with-temp-file</span> <span style=color:#5a2>&#34;/tmp/1.org&#34;</span>
</span></span><span style=display:flex><span>  (<span style=color:#000>insert</span> <span style=color:#5a2>&#34;hello world&#34;</span>)
</span></span><span style=display:flex><span>  (<span style=color:#000>message</span> <span style=color:#5a2>&#34;file content: %s&#34;</span> (<span style=color:#000>buffer-string</span>))
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><h3 id=execute-shell-command>execute shell command</h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>shell-command</span> <span style=color:#5a2>&#34;echo hello&#34;</span>)
</span></span></code></pre></div><h2 id=modern-libraries>Modern libraries</h2><h3 id=ht-dot-el-for-hashtables>ht.el for hashtables</h3><p>Reference <a href=https://github.com/Wilfred/ht.el>ht.el</a> for more details.</p><h4 id=creating-a-hash-table>creating a hash table</h4><p>Create an empty hash table</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>let*</span> ((<span style=color:#000>the-dic</span> (<span style=color:#000>ht-create</span>)))
</span></span><span style=display:flex><span>  <span style=color:#000>the-dic</span>
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><p>Create a hash table with initial records</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>let*</span> ((<span style=color:#000>the-dic</span> (<span style=color:#000>ht</span>
</span></span><span style=display:flex><span>                 (<span style=color:#5a2>&#34;name&#34;</span> <span style=color:#5a2>&#34;Tom&#34;</span>)
</span></span><span style=display:flex><span>                 (<span style=color:#5a2>&#34;sex&#34;</span> <span style=color:#5a2>&#39;male</span>))))
</span></span><span style=display:flex><span>  <span style=color:#000>the-dic</span>
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><h4 id=accessing-the-hash-table>accessing the hash table</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>let*</span> ((<span style=color:#000>the-dic</span> (<span style=color:#000>ht</span> (<span style=color:#5a2>&#34;name&#34;</span> <span style=color:#5a2>&#34;Tom&#34;</span>) (<span style=color:#5a2>&#34;sex&#34;</span> <span style=color:#5a2>&#39;male</span>))))
</span></span><span style=display:flex><span>  <span style=color:#888;font-style:italic>;; get a record</span>
</span></span><span style=display:flex><span>  <span style=color:#888;font-style:italic>;; returns &#34;Tom&#34;</span>
</span></span><span style=display:flex><span>  (<span style=color:#000>ht-get</span> <span style=color:#000>the-dic</span> <span style=color:#5a2>&#34;name&#34;</span>)
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><h4 id=iterating-over-the-hash-table>Iterating over the hash table</h4><p>Readonly mapping:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>let*</span> ((<span style=color:#000>the-dic</span> (<span style=color:#000>ht</span> (<span style=color:#5a2>&#34;name&#34;</span> <span style=color:#5a2>&#34;Tom&#34;</span>) (<span style=color:#5a2>&#34;sex&#34;</span> <span style=color:#5a2>&#39;male</span>) (<span style=color:#5a2>&#34;age&#34;</span> <span style=color:#3af>18</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#000>ht-map</span> (<span style=color:#000>lambda</span> (<span style=color:#000>key</span> <span style=color:#000>value</span>) (<span style=color:#000>message</span> <span style=color:#5a2>&#34;%S: %S&#34;</span> <span style=color:#000>key</span> <span style=color:#000>value</span>)) <span style=color:#000>the-dic</span>)
</span></span><span style=display:flex><span>  )
</span></span></code></pre></div><p>Mutable mapping:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#000>let*</span> ((<span style=color:#000>the-dic</span> (<span style=color:#000>ht</span> (<span style=color:#5a2>&#34;name&#34;</span> <span style=color:#5a2>&#34;Tom&#34;</span>) (<span style=color:#5a2>&#34;sex&#34;</span> <span style=color:#5a2>&#39;male</span>) (<span style=color:#5a2>&#34;age&#34;</span> <span style=color:#3af>18</span>))))
</span></span><span style=display:flex><span>  (<span style=color:#000>ht-map</span> (<span style=color:#000>lambda</span> (<span style=color:#000>key</span> <span style=color:#000>value</span>)
</span></span><span style=display:flex><span>            <span style=color:#888;font-style:italic>;; modify the value if is string</span>
</span></span><span style=display:flex><span>            (<span style=color:#000>setf</span> <span style=color:#000>value</span> (<span style=color:#000>if</span> (<span style=color:#000>stringp</span> <span style=color:#000>value</span>)
</span></span><span style=display:flex><span>                            (<span style=color:#000>concat</span> <span style=color:#5a2>&#34;modified &#34;</span> <span style=color:#000>value</span>)
</span></span><span style=display:flex><span>                          <span style=color:#000>value</span>))) <span style=color:#000>the-dic</span>))
</span></span></code></pre></div><p class="footer text-center">Copyright (c) 2023 Chunwei Yan</p></main></div><script src=/js/feather.min.js></script>
<script>feather.replace()</script></body></html>