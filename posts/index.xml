<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Superjomn's blog</title><link>/posts/</link><description>Recent content in Posts on Superjomn's blog</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Tue, 18 Apr 2023 00:00:00 +0000</lastBuildDate><atom:link href="/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Apple TV 折腾记</title><link>/posts/apple-tv-as-service/</link><pubDate>Tue, 18 Apr 2023 00:00:00 +0000</pubDate><guid>/posts/apple-tv-as-service/</guid><description>&lt;p>由于房屋面积有限，我们的大厅一直没有安装电视。相反，我们使用了一个较大的LG 4K显示器作为娱乐中心，并搭配了两个巨大的Fyne落地音箱，效果不错。我们主要观看的节目是Netflix，晚上我们会和家人一起围在电脑旁边观看，感觉还不错。但是，将显示器用作电视存在一个问题，就是必须通过操作系统进行操作。由于我的职业是程序员，一旦接触电脑，就不由自主地敲击键盘，并且很容易进入工作模式，这对放松娱乐有些影响。&lt;/p>
&lt;p>因此，我开始考虑使用Apple TV作为我们的娱乐中心。我选择这个方案的原因如下：&lt;/p>
&lt;ol>
&lt;li>电视盒子本身可以提供完整的电视体验，操作相对简单，可以将电脑关闭以便更好地放松娱乐。&lt;/li>
&lt;li>Apple TV可以安装Netflix、Youtube等应用程序，支持我们现有的娱乐方式。&lt;/li>
&lt;li>它具有HDMI接口，完美兼容我们现有的4K显示器，并且在未来升级成电视时也不会有问题。&lt;/li>
&lt;/ol>
&lt;p>现在，我们家的娱乐系统已经成为一套完整的影音系统。下面是我使用Apple TV的Recipe和我的考虑，供大家参考。&lt;/p>
&lt;p>&lt;strong>Apple TV 本体&lt;/strong>&lt;/p>
&lt;p>Apple TV 本体还是挺便宜的，可能 Apple 真正挣钱的是 Itunes 这类订阅服务吧，硬件只是附带的。我买的型号是 &amp;ldquo;Apple 苹果TV电视21/22新款 TV6 4K机顶盒子TV 7代 5.0 A15仿生电视盒子 苹果TV7代 128GB WIFI+网线版 美版&amp;rdquo;，价格是 1379人民币，你可以在淘宝或者京东找到。&lt;/p>
&lt;p>&lt;strong>Wifi路由器&lt;/strong>&lt;/p>
&lt;p>接下来需要有一款可以科学上网的 Wifi 路由器，这类 Wifi 由于要安装固件以及 ShadowSocks APP，因此一般配置要高一些也贵一些。&lt;/p>
&lt;p>路由器一般要安装梅林固件，你最好了解下 &lt;a href="https://zhuanlan.zhihu.com/p/205303870">梅林固件到底是什么-zhihu&lt;/a>，只有华硕的一部分型号可以支持。&lt;/p>
&lt;p>我选择的是 &amp;ldquo;华硕（ASUS）RT-AX86U双频5700M全千兆电竞路由无线路由器/一键性能加速/2.5G端口/WiFi6路由/PS5网络加速&amp;rdquo;，同样你可以在京东或者淘宝找到这款路由器，拼多多或者咸鱼上有可能找到更便宜的价格。
这是一款中高端的路由器，性能应该有点过剩了，我之前计划利用它自带的 USB 接口搭建一个简易的 NAS，但考虑到 4GB 的单个文件限制，最终没有实施；目前这是一个欠开发的，比较奢侈的路由器。&lt;/p>
&lt;p>路由器连上网络后，需要刷梅林固件，这个网上教程很多，我参考比较多的是 &lt;a href="https://www.youtube.com/watch?v=TKP3w1tlxL0">这个&lt;/a>。 当然，前提是有个科学上网的 V&amp;amp;P&amp;amp;N，绑定到 WIFI 路由器中。&lt;/p>
&lt;p>激活网络后，Apple TV 连上 WIFI，现在你应该已经能够激活和使用 Apple TV 了。&lt;/p>
&lt;p>&lt;strong>音响DAC的支持&lt;/strong>&lt;/p>
&lt;p>虽然Apple TV支持AirPlay音源输出，但如果家里的音响是类似于HomePod或其他支持的播放器，只需要在设置里进行添加，就可以正常使用了。然而，由于我家里有一套音响系统，有专门的DAC，所以使用AirPlay这类有损的传输就比较可惜了。因此，我找到了一款HDMI拆分音源信息到光纤的转换器，名为“毕亚兹 HDMI2.0音频分离器线 4K/60HZ高清视频7.1光纤/同轴/3.5mm音频转换器笔记本机顶盒连接电视音响 ZH136”，可以完美支持AURALIC这类播放器的光纤输入。
注意，这里特定的参数才能支持 4K 视频的输出。转换后的音质与电脑的USB相比没有明显的差别，对于电视节目已经足够了吧。&lt;/p>
&lt;p>&lt;strong>NAS系统&lt;/strong>
由于我有本地的音乐和视频想要组合到Apple TV的系统里，因此我额外花了不少银子搭建了一套NAS系统。如果您主要使用流媒体，这个基本上不是必需品，因为价格基本上比上面的组件加起来还要高一些。&lt;/p>
&lt;p>之前我没有接触过NAS系统，并且也想降低不兼容的风险，所以我选择了群晖现成的NAS，DS220这款，外加希捷酷狼8TB的企业盘，从闲置的台式机上拆下来一个1TB的盘，七拼八凑跑起来了。目前这一套运行得不错，我经常使用自带的Download Station下载BT文件，目前有一半的节目是NAS提供的。&lt;/p>
&lt;p>谈到NAS，Apple TV上的Infuse应用程序确实很实用，但是我尝试在App Store上付费时，似乎大陆的VISA无法使用。不过，总之还是通过各种折腾成功地使用了。&lt;/p>
&lt;p>总结下，除了 Apple TV 本体外，科学上网的 WIFI 路由器提供网络；NAS 提供本地的 BT 下载和视频服务；如果你要支持 DAC 那额外的 HDMI 拆光纤的转接口也是需要的。&lt;/p>
&lt;p>折腾不易，且行珍惜。&lt;/p>
&lt;p>老实说，这样一套操作下来，我觉得折腾的成本还是比较高的，从金钱到精力的投入都比较可观的，非技术宅折腾可能有点困难了。&lt;/p></description></item><item><title>Python VM 执行方式简要探索</title><link>/posts/python-vm-brief-introduction/</link><pubDate>Fri, 24 Feb 2023 00:00:00 +0000</pubDate><guid>/posts/python-vm-brief-introduction/</guid><description>&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>&lt;a href="#python-code-object">Python Code Object&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#%E6%9C%89%E7%94%A8%E7%9A%84-attribute">有用的 attribute&lt;/a>&lt;/li>
&lt;li>&lt;a href="#python-bytecode-%E7%90%86%E8%A7%A3">Python Bytecode 理解&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#python-frame">Python Frame&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#%E4%BF%AE%E6%94%B9-frame-%E7%9A%84-code-object">修改 Frame 的 Code Object&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#%E6%80%BB%E7%BB%93">总结&lt;/a>&lt;/li>
&lt;li>&lt;a href="#fyi">FYI&lt;/a>&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;p>最近在看 TorchDynamo 的东西，里面需要对 Python 执行机制有一些了解，所以单独拆开放到了这篇文章里。&lt;/p>
&lt;p>本文会从可复现的角度，多一些可以执行的例子。&lt;/p>
&lt;h2 id="python-code-object">Python Code Object&lt;/h2>
&lt;p>这里是简单的介绍，详细的可以参考 &lt;a href="https://leanpub.com/insidethepythonvirtualmachine/read#leanpub-auto-code-objects">code objects&lt;/a> 这本书的章节。&lt;/p>
&lt;p>Code object 用来记录 Python 的 byte code，对应的粒度是 Block，这里的 Block 可以包含从 Module 到 Class definition 到 Function body 的各类结构（有别于编译器里面的 BasicBlock）。 可以理解 Code object 是可以嵌套的。&lt;/p>
&lt;p>我们先从一个简单的函数开始&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">foo&lt;/span>(&lt;span style="color:#000">name&lt;/span>, &lt;span style="color:#000">age&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;&amp;#39;&amp;#39; Get the information of a person. &amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">born&lt;/span> = &lt;span style="color:#3af">2023&lt;/span> - &lt;span style="color:#000">age&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">return&lt;/span> &lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;hello &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">, born at &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">born&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看其 Code object:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">foo&lt;/span>.&lt;span style="color:#000">__code__&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>&amp;lt;code object foo at 0x7f4da6f59500, file &amp;#34;/tmp/ipykernel_2935902/3583013317.py&amp;#34;, line 1&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="有用的-attribute">有用的 attribute&lt;/h3>
&lt;p>那 &lt;code>foo.__code__&lt;/code> 中包含的有用的 attribute 如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dir&lt;/span>(&lt;span style="color:#000">foo&lt;/span>.&lt;span style="color:#000">__code__&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>得到&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>[&lt;span style="color:#5a2">&amp;#39;__class__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__delattr__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__dir__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__doc__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__eq__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__format__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__ge__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__getattribute__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__gt__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__hash__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__init__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__init_subclass__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__le__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__lt__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__ne__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__new__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__reduce__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__reduce_ex__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__repr__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__setattr__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__sizeof__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__str__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;__subclasshook__&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;co_argcount&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;co_cellvars&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;co_nlocals&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;co_posonlyargcount&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;co_stacksize&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;co_varnames&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#5a2">&amp;#39;replace&amp;#39;&lt;/span>]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中比较多打交道的属性如下&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>co_names&lt;/code>&lt;/strong> is a tuple containing global attributes and methods used inside the scope,&lt;/li>
&lt;li>&lt;strong>&lt;code>co_varname&lt;/code>&lt;/strong> is the tuple containing local variable names used in function,&lt;/li>
&lt;li>&lt;strong>&lt;code>co_consts&lt;/code>&lt;/strong> returns the literals used by bytecode.&lt;/li>
&lt;/ul>
&lt;p>对应属性的内容如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">call_foo&lt;/span>.&lt;span style="color:#000">__code__&lt;/span>.&lt;span style="color:#000">co_names&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>co_names&lt;/code> 是空的，因为 &lt;code>foo&lt;/code> 函数里面没有调用任何的外部函数或属性。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">foo&lt;/span>.&lt;span style="color:#000">__code__&lt;/span>.&lt;span style="color:#000">co_varnames&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>co_varnames&lt;/code> 比较丰富，看到 local scope 可以用的 variable name 都在里面，包括两个 argument： name 和 age，以及一个 local variable： born。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">foo&lt;/span>.&lt;span style="color:#000">__code__&lt;/span>.&lt;span style="color:#000">co_consts&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>co_consts&lt;/code> 意料外有好几个，一类是 code 里面用到的 &lt;strong>2023&lt;/strong> 这个常量，另外几个字符串是 string format 里面分割开的几个字段。&lt;/p>
&lt;h3 id="python-bytecode-理解">Python Bytecode 理解&lt;/h3>
&lt;p>接下来我们尝试理解下简单的 Python bytecode，接着上面的例子。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">dis&lt;/span>.&lt;span style="color:#000">dis&lt;/span>(&lt;span style="color:#000">foo&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span> 2 0 LOAD_CONST 1 (2023)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 2 LOAD_FAST 1 (age)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 4 BINARY_SUBTRACT
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 6 STORE_FAST 2 (born)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 3 8 LOAD_CONST 2 (&amp;#39;hello &amp;#39;)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 10 LOAD_FAST 0 (name)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 12 FORMAT_VALUE 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 14 LOAD_CONST 3 (&amp;#39;, born at &amp;#39;)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 16 LOAD_FAST 2 (born)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 18 FORMAT_VALUE 0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 20 LOAD_CONST 4 (&amp;#39;!&amp;#39;)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 22 BUILD_STRING 5
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 24 RETURN_VALUE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上面 dump 出来的内容包含了 &lt;code>dis&lt;/code> 增加的一些 human readable 的 hint，具体内容可以分为 3 列：&lt;/p>
&lt;ol>
&lt;li>表示原始 Python 源代码中的行号&lt;/li>
&lt;li>bytecode 中的行号以及对应的 opcode&lt;/li>
&lt;li>argument ID，圆括弧里面是一些 hint&lt;/li>
&lt;/ol>
&lt;p>这里需要提一下， Python 的执行方式是基于 Stack 而非 Register，带来的好处就是 bytecode 逻辑非常简单，常见的操作如下&lt;/p>
&lt;ul>
&lt;li>在执行一个 Opcode 前，将其所需的 variable 压栈&lt;/li>
&lt;li>执行这个 Opcode 时，从 stack 中 Pop 所需数目的 variable&lt;/li>
&lt;li>将执行结果压入 stack 中，备后续使用&lt;/li>
&lt;/ul>
&lt;p>上面的前三行 code&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-nil" data-lang="nil">2 0 LOAD_CONST 1 (2023)
2 LOAD_FAST 1 (age)
4 BINARY_SUBTRACT
&lt;/code>&lt;/pre>&lt;p>表示的是&lt;/p>
&lt;ol>
&lt;li>将 1st 常量 2023 压栈&lt;/li>
&lt;li>将 1st 变量 age 压栈&lt;/li>
&lt;li>Pop 两个值，并执行 2023 - age&lt;/li>
&lt;li>将结果压栈&lt;/li>
&lt;/ol>
&lt;p>Opcode 有一些具体的含义，比如其中几个比较重要的&lt;/p>
&lt;ul>
&lt;li>&lt;code>LOAD_CONST&lt;/code> 表示是从 Code object 的 &lt;code>co_consts&lt;/code> 里面 load
&lt;ul>
&lt;li>参考上节，~co_consts~ 第 1 个 value 是 2023， 因此 &lt;code>LOAD_CONST 1&lt;/code> 表示 Load 2023 进 stack，跟末尾的 hint 对应起来了&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>LOAD_FAST&lt;/code> 是从 &lt;code>co_varnames&lt;/code> 里面 Load 到 stack&lt;/li>
&lt;li>&lt;code>STORE_FAST&lt;/code> 表示将 stack 的 head 中的值 Store 到 &lt;code>co_varnames&lt;/code> 里面的一个 variable&lt;/li>
&lt;li>&lt;code>RETURN_VALUE&lt;/code> 表示将 stack 中包含的所有值返回&lt;/li>
&lt;/ul>
&lt;p>完整的 opcode 及对应的 Python 的处理行为可以参考 &lt;a href="https://github.com/python/cpython/blob/22b8d77b98a5944e688be0927b8139c49d4a7257/Python/generated_cases.c.h">Python/generated_cases.c.h&lt;/a>，内容非常清晰，截取 &lt;code>LOAD_FAST&lt;/code> 对应的代码：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">TARGET&lt;/span>(&lt;span style="color:#000">LOAD_FAST&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject&lt;/span> *&lt;span style="color:#000">value&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">value&lt;/span> = &lt;span style="color:#000">GETLOCAL&lt;/span>(&lt;span style="color:#000">oparg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">assert&lt;/span>(&lt;span style="color:#000">value&lt;/span> != &lt;span style="color:#000">NULL&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">Py_INCREF&lt;/span>(&lt;span style="color:#000">value&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">STACK_GROW&lt;/span>(&lt;span style="color:#3af">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">POKE&lt;/span>(&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#000">value&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">DISPATCH&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="python-frame">Python Frame&lt;/h2>
&lt;p>Python Code Object 存储了待执行的 Python bytecode，但这些 bytecode 无法直接执行，还需要专门的 Interpreter 机制。
这跟 C/C++ 完全不同，毕竟 bytecode 和 machine code 完全是两码事。&lt;/p>
&lt;p>为了执行 bytecode， Python 对应有 Frame Object 的数据结构，简单可以认为 Frame Object 跟 Code Object 对应，前者 hold 执行一个 Code Object 所需要的所有 runtime 的信息，而后者则记录了具体需要执行的 bytecode。
因此，当从一个 Block 跳到另外一个 Block 时候，会有 Frame 的切换，例如，function call 时，会先 hold 住当前的 Frame，创建一个新的 Frame 接着执行该 function 对应的 Code Object； 执行完毕，则跳回先前的 Frame。&lt;/p>
&lt;p>Frame 具体数据结构我们需要参考下 &lt;a href="https://github.com/python/cpython/blob/main/Include/internal/pycore_frame.h#L16">pycore_frame.h/_frame&lt;/a> 相关的 code：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">struct&lt;/span> &lt;span style="color:#000">_frame&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject_HEAD&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyFrameObject&lt;/span> *&lt;span style="color:#000">f_back&lt;/span>; &lt;span style="color:#888;font-style:italic">/* previous frame, or NULL */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">struct&lt;/span> &lt;span style="color:#000">_PyInterpreterFrame&lt;/span> *&lt;span style="color:#000">f_frame&lt;/span>; &lt;span style="color:#888;font-style:italic">/* points to the frame data */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject&lt;/span> *&lt;span style="color:#000">f_trace&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Trace function */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">int&lt;/span> &lt;span style="color:#000">f_lineno&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Current line number. Only valid if non-zero */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">char&lt;/span> &lt;span style="color:#000">f_trace_lines&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Emit per-line trace events? */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">char&lt;/span> &lt;span style="color:#000">f_trace_opcodes&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Emit per-opcode trace events? */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">char&lt;/span> &lt;span style="color:#000">f_fast_as_locals&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Have the fast locals of this frame been converted to a dict? */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic">/* The frame data, if this frame object owns the frame */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject&lt;/span> *&lt;span style="color:#000">_f_frame_data&lt;/span>[&lt;span style="color:#3af">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>};
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中 &lt;code>f_back&lt;/code> 指针用来 chain 多个跳转的 Frame，这样上面的 function call 才可以实施。&lt;/p>
&lt;p>&lt;code>f_frame&lt;/code> 记录了一个 Frame 具体的信息，接着看下如下 code&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">typedef&lt;/span> &lt;span style="color:#00f">struct&lt;/span> &lt;span style="color:#000">_PyInterpreterFrame&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyCodeObject&lt;/span> *&lt;span style="color:#000">f_code&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Strong reference */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">struct&lt;/span> &lt;span style="color:#000">_PyInterpreterFrame&lt;/span> *&lt;span style="color:#000">previous&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject&lt;/span> *&lt;span style="color:#000">f_funcobj&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Strong reference. Only valid if not on C stack */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject&lt;/span> *&lt;span style="color:#000">f_globals&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Borrowed reference. Only valid if not on C stack */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject&lt;/span> *&lt;span style="color:#000">f_builtins&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Borrowed reference. Only valid if not on C stack */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject&lt;/span> *&lt;span style="color:#000">f_locals&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Strong reference, may be NULL. Only valid if not on C stack */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyFrameObject&lt;/span> *&lt;span style="color:#000">frame_obj&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Strong reference, may be NULL. Only valid if not on C stack */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic">// NOTE: This is not necessarily the last instruction started in the given
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic">// frame. Rather, it is the code unit *prior to* the *next* instruction. For
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic">// example, it may be an inline CACHE entry, an instruction we just jumped
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic">// over, or (in the case of a newly-created frame) a totally invalid value:
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#000">_Py_CODEUNIT&lt;/span> *&lt;span style="color:#000">prev_instr&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">int&lt;/span> &lt;span style="color:#000">stacktop&lt;/span>; &lt;span style="color:#888;font-style:italic">/* Offset of TOS from localsplus */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">uint16_t&lt;/span> &lt;span style="color:#000">yield_offset&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">char&lt;/span> &lt;span style="color:#000">owner&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic">/* Locals and stack */&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyObject&lt;/span> *&lt;span style="color:#000">localsplus&lt;/span>[&lt;span style="color:#3af">1&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>} &lt;span style="color:#000">_PyInterpreterFrame&lt;/span>;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这里比较明确的是&lt;/p>
&lt;ul>
&lt;li>&lt;code>f_code&lt;/code> 肯定是指向对应的 Code Object&lt;/li>
&lt;li>&lt;code>f_globals&lt;/code>, &lt;code>f_locals&lt;/code> 应该直接对应到 Code Object 里面的 &lt;code>co_names&lt;/code> 和 &lt;code>co_varnames&lt;/code>&lt;/li>
&lt;li>&lt;code>stacktop&lt;/code> 对应着 stack 中的 top 位置&lt;/li>
&lt;/ul>
&lt;h3 id="修改-frame-的-code-object">修改 Frame 的 Code Object&lt;/h3>
&lt;p>得益于 &lt;a href="https://peps.python.org/pep-0523/">PEP 523&lt;/a>，从 Python 3.6 开始，一个 &lt;code>PyEval_EvalFrameEx()&lt;/code> 函数加入了 Python API，不同于之前的 &lt;code>PyEval_EvalFrameDefault()&lt;/code> ， 新函数允许用户自定义 Frame Object 执行过程。&lt;/p>
&lt;p>类似 TorchDynamo，与 Python 交互最核心的也是通过这个 API。&lt;/p>
&lt;p>API 的实现很简单：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">PyObject&lt;/span> *
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">PyEval_EvalFrameEx&lt;/span>(&lt;span style="color:#000">PyFrameObject&lt;/span> *&lt;span style="color:#000">frame&lt;/span>, &lt;span style="color:#00f">int&lt;/span> &lt;span style="color:#000">throwflag&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">PyThreadState&lt;/span> *&lt;span style="color:#000">tstate&lt;/span> = &lt;span style="color:#000">PyThreadState_GET&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">return&lt;/span> &lt;span style="color:#000">tstate&lt;/span>-&amp;gt;&lt;span style="color:#000">interp&lt;/span>-&amp;gt;&lt;span style="color:#000">eval_frame&lt;/span>(&lt;span style="color:#000">frame&lt;/span>, &lt;span style="color:#000">throwflag&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>只要用户设置了自定义的 interpreter，那就执行自定义的 &lt;code>eval_frame&lt;/code> 逻辑，这一点也是 TorchDynamo 的核心。&lt;/p>
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>本文主要介绍了 Python 执行机制中 Code Object 和 Frame Object 两个重要的概念，具体特点如下&lt;/p>
&lt;ul>
&lt;li>Code Object 和 Frame Object 对应到 Block 粒度&lt;/li>
&lt;li>Code Object 主要记录了 bytecode 以及 &lt;code>co_names&lt;/code>, &lt;code>co_varnames&lt;/code> 等一大类静态信息&lt;/li>
&lt;li>Frame Object 跟 Code Object 基本一一对应，记录了执行所需的信息，当出现类似 function call，新的 Frame Object 会创建接着执行，完毕后再返回当前 Frame&lt;/li>
&lt;/ul>
&lt;h2 id="fyi">FYI&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://leanpub.com/insidethepythonvirtualmachine/read#leanpub-auto-code-objects">Inside the Python Virtual Machine&lt;/a> ，一本详细讲解 Python VM 的书&lt;/li>
&lt;li>&lt;a href="https://tenthousandmeters.com/blog/python-behind-the-scenes-1-how-the-cpython-vm-works/">Python behind the scenes #1: how the CPython VM works&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Python functools 包简要实践</title><link>/posts/python-functools-introduction/</link><pubDate>Wed, 22 Feb 2023 00:00:00 +0000</pubDate><guid>/posts/python-functools-introduction/</guid><description>&lt;h2 id="python-functools-包简要实践">Python functools 包简要实践&lt;/h2>
&lt;p>在阅读 Pytorch 代码时，发现很多 Python 的新的用法比较有趣，之前笔者大部分时间在 C++ 上，这里整理和记录一些有趣的用法。
本文先从 functools 这个包开始。&lt;/p>
&lt;h3 id="total-ordering-shortcut-to-make-class-orderable">@total_ordering shortcut to make class orderable&lt;/h3>
&lt;p>为了让一个 Class 能够比较，我们正常需要定义一堆 slots， &lt;code>__gt__()&lt;/code>, &lt;code>__ge__()&lt;/code>,~_&lt;em>lt&lt;/em>_()~, &lt;code>__le__()&lt;/code>, &lt;code>__eq__()&lt;/code> 等等。
但其实只需要 &lt;code>__eq__()&lt;/code> 和 其他任一方法(比如 &lt;code>__gt__()&lt;/code> ) 便可以组合出其他方法。&lt;/p>
&lt;p>&lt;code>@total_ordering&lt;/code> 便用于这类场景的 helper，如下代码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">from&lt;/span> &lt;span style="color:#000">functools&lt;/span> &lt;span style="color:#00f">import&lt;/span> &lt;span style="color:#000">total_ordering&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">@total_ordering&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">class&lt;/span> &lt;span style="color:#000">Stuff&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">__init__&lt;/span>(&lt;span style="color:#000">self&lt;/span>, &lt;span style="color:#000">x&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">self&lt;/span>.&lt;span style="color:#000">x&lt;/span> = &lt;span style="color:#000">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">__eq__&lt;/span>(&lt;span style="color:#000">self&lt;/span>, &lt;span style="color:#000">other&lt;/span>:&lt;span style="color:#5a2">&amp;#34;Stuff&amp;#34;&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">return&lt;/span> &lt;span style="color:#000">self&lt;/span>.&lt;span style="color:#000">x&lt;/span> == &lt;span style="color:#000">other&lt;/span>.&lt;span style="color:#000">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">__gt__&lt;/span>(&lt;span style="color:#000">self&lt;/span>, &lt;span style="color:#000">other&lt;/span>:&lt;span style="color:#5a2">&amp;#34;Stuff&amp;#34;&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">return&lt;/span> &lt;span style="color:#000">self&lt;/span>.&lt;span style="color:#000">x&lt;/span> &amp;gt; &lt;span style="color:#000">other&lt;/span>.&lt;span style="color:#000">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">a&lt;/span> = &lt;span style="color:#000">Stuff&lt;/span>(&lt;span style="color:#3af">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">b&lt;/span> = &lt;span style="color:#000">Stuff&lt;/span>(&lt;span style="color:#3af">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;a &amp;lt; b? &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">a&lt;/span> &amp;lt; &lt;span style="color:#000">b&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>a &amp;lt; b? True
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="partial-to-reuse-a-existing-method-by-fixing-some-arguments">partial() to reuse a existing method by fixing some arguments&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">from&lt;/span> &lt;span style="color:#000">functools&lt;/span> &lt;span style="color:#00f">import&lt;/span> &lt;span style="color:#000">partial&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">func0&lt;/span>(&lt;span style="color:#000">a&lt;/span>, &lt;span style="color:#000">b&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;a:&lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">a&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">, b:&lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">b&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">func1&lt;/span> = &lt;span style="color:#000">partial&lt;/span>(&lt;span style="color:#000">func0&lt;/span>, &lt;span style="color:#000">a&lt;/span> = &lt;span style="color:#3af">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#000">func1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">func1&lt;/span>(&lt;span style="color:#000">b&lt;/span>=&lt;span style="color:#3af">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># reset argument a&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">func1&lt;/span>(&lt;span style="color:#000">a&lt;/span>=&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#000">b&lt;/span>=&lt;span style="color:#3af">10&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>functools.partial(&amp;lt;function func0 at 0x7fdf180e4f70&amp;gt;, a=0)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a:0, b:10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>a:1, b:10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>从例子可以看出， &lt;code>partial&lt;/code> 效果有点类似设定了默认值，新的函数依旧依旧可以设置被 fixed 的 argument。&lt;/p>
&lt;h3 id="warps-to-help-define-better-decorators">@warps to help define better decorators&lt;/h3>
&lt;p>之前，定义 decorator 的 naivie 的方式是&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">decorator&lt;/span>(&lt;span style="color:#000">func&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">actual_func&lt;/span>(*&lt;span style="color:#000">args&lt;/span>, **&lt;span style="color:#000">kwargs&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;Before Calling &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">func&lt;/span>.&lt;span style="color:#000">__name__&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">func&lt;/span>(*&lt;span style="color:#000">args&lt;/span>, **&lt;span style="color:#000">kwargs&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;After Calling &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">func&lt;/span>.&lt;span style="color:#000">__name__&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">return&lt;/span> &lt;span style="color:#000">actual_func&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">@decorator&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">greet&lt;/span>(&lt;span style="color:#000">name&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;Hello, &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">!&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">greet&lt;/span>(&lt;span style="color:#5a2">&amp;#34;Martin&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>Before Calling greet
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Hello, Martin!
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>After Calling greet
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如上， &lt;code>greet&lt;/code> 方法实现了既有的功能，但有一个问题，当执行&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#000">greet&lt;/span>.&lt;span style="color:#000">__name__&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>也就是原有的 &lt;code>greet&lt;/code> 的属性都变化了（其实是 greet 替换成了 actual_func），这个不是我们希望的。
&lt;code>warps&lt;/code> 方法就用来将 &lt;code>actual_func&lt;/code> 伪装回 &lt;code>greet&lt;/code> ，让装饰器看起来没有改变表象的东西。&lt;/p>
&lt;p>简单用法如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">from&lt;/span> &lt;span style="color:#000">functools&lt;/span> &lt;span style="color:#00f">import&lt;/span> &lt;span style="color:#000">wraps&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">decorator&lt;/span>(&lt;span style="color:#000">func&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">@wraps&lt;/span>(&lt;span style="color:#000">func&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">actual_func&lt;/span>(*&lt;span style="color:#000">args&lt;/span>, **&lt;span style="color:#000">kwargs&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;Before Calling &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">func&lt;/span>.&lt;span style="color:#000">__name__&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">func&lt;/span>(*&lt;span style="color:#000">args&lt;/span>, **&lt;span style="color:#000">kwargs&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;After Calling &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">func&lt;/span>.&lt;span style="color:#000">__name__&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">return&lt;/span> &lt;span style="color:#000">actual_func&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">@decorator&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">greet&lt;/span>(&lt;span style="color:#000">name&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#5a2">f&lt;/span>&lt;span style="color:#5a2">&amp;#34;Hello, &lt;/span>&lt;span style="color:#5a2">{&lt;/span>&lt;span style="color:#000">name&lt;/span>&lt;span style="color:#5a2">}&lt;/span>&lt;span style="color:#5a2">!&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">print&lt;/span>(&lt;span style="color:#000">greet&lt;/span>.&lt;span style="color:#000">__name__&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-text" data-lang="text">&lt;span style="display:flex;">&lt;span>greet
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>哈哈，greet 还是 greet。&lt;/p>
&lt;h2 id="lru-cache">&lt;code>@lru_cache&lt;/code>&lt;/h2>
&lt;p>默认 &lt;code>maxsize=128&lt;/code> ，可以设置 &lt;code>maxsize=None&lt;/code> 来确定无限 cache。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">@functools.lru_cache&lt;/span>(&lt;span style="color:#000">maxsize&lt;/span>=&lt;span style="color:#3af">1000&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">factorial&lt;/span>(&lt;span style="color:#000">n&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">return&lt;/span> &lt;span style="color:#000">n&lt;/span> * &lt;span style="color:#000">factorial&lt;/span>(&lt;span style="color:#000">n&lt;/span>-&lt;span style="color:#3af">1&lt;/span>) &lt;span style="color:#00f">if&lt;/span> &lt;span style="color:#000">n&lt;/span> &lt;span style="color:#00f">else&lt;/span> &lt;span style="color:#3af">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="reference">Reference&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://dzone.com/articles/functools-useful-decorators-amp-functions-1">Useful Decorators and Functions in Python&amp;rsquo;s Functools&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://towardsdatascience.com/functools-the-power-of-higher-order-functions-in-python-8e6e61c6e4e4">Functools — The Power of Higher-Order Functions in Python&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>OpenAI/Triton MLIR 迁移工作简介</title><link>/posts/triton-mlir-publish/</link><pubDate>Tue, 15 Nov 2022 00:00:00 +0000</pubDate><guid>/posts/triton-mlir-publish/</guid><description>&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>&lt;a href="#triton-%E7%AE%80%E4%BB%8B">Triton 简介&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#%E5%AE%9A%E4%BD%8D">定位&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%E6%96%B0%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E6%9E%B6%E6%9E%84">新代码中的架构&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#python-%E7%95%8C%E9%9D%A2%E4%B9%8B-frontend">Python 界面之 Frontend&lt;/a>&lt;/li>
&lt;li>&lt;a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B-optimizer">性能优化之 Optimizer&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#tritongpu-dialect">TritonGPU Dialect&lt;/a>&lt;/li>
&lt;li>&lt;a href="#tritonir-%E7%9A%84%E4%BC%98%E5%8C%96">TritonIR 的优化&lt;/a>&lt;/li>
&lt;li>&lt;a href="#tritongpu-ir-%E7%9A%84%E4%BC%98%E5%8C%96">TritonGPU IR 的优化&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#%E9%AB%98%E6%80%A7%E8%83%BD-llvm-%E7%94%9F%E6%88%90%E4%B9%8B-backend">高性能 LLVM 生成之 Backend&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#ptx-inline-asm">PTX inline asm&lt;/a>&lt;/li>
&lt;li>&lt;a href="#mma-%E6%8C%87%E4%BB%A4%E7%94%9F%E6%88%90">MMA 指令生成&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#fyi">FYI&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#gemm-%E5%9C%A8-optimizer-pass-%E6%95%88%E6%9E%9C">GEMM 在 Optimizer Pass 效果&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;p>经过几个月的不懈努力，OpenAI Triton已经成功完成了面向MLIR Infra的迁移/重构工作，并将其最新的基于MLIR的代码合并至主分支。这个工作是由OpenAI和NVIDIA相关团队近几个月来深入合作完成的，而我也有幸参与其中。在这篇文章中，我将分享一些技术总结，记录一些收获和思考。&lt;/p>
&lt;p>尽管Triton目前的开源开发非常迅速，但本文将主要聚焦于基于MLIR Infra进行重构的第一个版本的&lt;a href="https://github.com/openai/triton/tree/ca05ef8e5b0b4d4834957bc31e7581b09d35c530">代码&lt;/a>（这应该也是两三个月前的）&lt;/p>
&lt;h2 id="triton-简介">Triton 简介&lt;/h2>
&lt;p>OpenAI Triton &lt;a href="https://www.eecs.harvard.edu/~htk/publication/2019-mapl-tillet-kung-cox.pdf">paper&lt;/a> 中的介绍是 &amp;ldquo;An Intermediate Language and Compiler for Tiled Neural Network Computations&amp;rdquo;，其中几个关键词应该能够代表其特点：&lt;/p>
&lt;ul>
&lt;li>&lt;em>Intermediate Language&lt;/em>, 目前是基于 Python 的 DSL&lt;/li>
&lt;li>&lt;em>Compiler&lt;/em> ，是一个经典的 Compiler 的架构&lt;/li>
&lt;li>&lt;em>Tiled&lt;/em> Computation，面向 GPU 体系特点，自动分析和实施 tiling&lt;/li>
&lt;/ul>
&lt;h3 id="定位">定位&lt;/h3>
&lt;p>由于 Triton 的开发非常迅速，这里只讨论当前 Triton 的功能。&lt;/p>
&lt;p>简而言之，Triton 提供了一套针对 GPU Kernel 的开发的 Language（基于 Python） 和 高性能 Compiler。&lt;/p>
&lt;figure>&lt;img src="/static/triton-publish/1.png"/>
&lt;/figure>
&lt;p>因此，就层次而言，Triton的 DNN 开发能力与 CUDA 的部分相对应，但与TVM、XLA等直接面向 DL 的 Domain compiler 无法完全对应。
后者更像是面向 DL 的武器库，拥有从构图到 auto fusion 等端到端的能力，而Triton则更像一把小巧、实用的瑞士军刀，面向偏底层的也是最通用的 Kernel 开发问题。&lt;/p>
&lt;h3 id="新代码中的架构">新代码中的架构&lt;/h3>
&lt;p>Triton 新代码中的架构总体上可以如下呈现&lt;/p>
&lt;figure>&lt;img src="/static/triton-publish/three-components.png"/>
&lt;/figure>
&lt;p>即总体上可以分为三大块&lt;/p>
&lt;ol>
&lt;li>Frontend，将用户的 Python kernel code 转换为 Triton IR，以及维护 kernel launch 的 Runtime&lt;/li>
&lt;li>Optimizer，通过各类 pass 将 Triton IR 逐步转换为优化过的 TritonGPU IR&lt;/li>
&lt;li>Backend，将 TritonGPU IR 逐步转换为 LLVM IR，并最终通过 ptxas 编译为 cubin&lt;/li>
&lt;/ol>
&lt;p>贯穿这三部分的核心表示是 Triton 的 IR，微观上，IR 也分为两个层次&lt;/p>
&lt;ol>
&lt;li>Triton Dialect，表示计算逻辑，硬件无关的表达&lt;/li>
&lt;li>TritonGPU Dialect，GPU 相关的计算表示&lt;/li>
&lt;/ol>
&lt;p>这两者都是基于 MLIR 的自定义 dialect，除此之外，Triton 也复用了很多社区的 dialect 来进行宏观的表示，包括&lt;/p>
&lt;ul>
&lt;li>&lt;code>std&lt;/code> dialect： tensor, int, float 等数据类型&lt;/li>
&lt;li>&lt;code>arith&lt;/code> dialect：各类数学操作&lt;/li>
&lt;li>&lt;code>scf&lt;/code> dialect：if, for 等控制流&lt;/li>
&lt;li>&lt;code>nvvm&lt;/code> dialect：获取 &lt;code>thread_id&lt;/code> 等少量操作&lt;/li>
&lt;li>&lt;code>gpu&lt;/code> dialect：printf 等少量操作&lt;/li>
&lt;/ul>
&lt;p>下图是 Triton 中核心表示完整的转换过程：&lt;/p>
&lt;figure>&lt;img src="/static/2023-01-29_15-59-49_screenshot.png"/>
&lt;/figure>
&lt;p>其中蓝色的两部分主要是 MLIR 体系涉及的部分，随后 MLIR 会转换为 LLVM IR，之后 Triton 会调用 NVPTX 转换为 PTX Assembly，随后由 CUDA 的 ptxas 编译器编译为 cubin。&lt;/p>
&lt;h2 id="python-界面之-frontend">Python 界面之 Frontend&lt;/h2>
&lt;p>Frontend 用于将用户用 Python 编写的 kernel 转换为对应的 Triton IR (Triton Dialect)，这里由于篇幅不便展开，细节可以阅读 &lt;a href="https://github.com/openai/triton/blob/ca05ef8e5b0b4d4834957bc31e7581b09d35c530/python/triton/compiler.py#L108">compiler.py::CodeGenerator&lt;/a> 中基于 Python ast 的规则。&lt;/p>
&lt;p>比如 vector add 的例子&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">@triton.jit&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">add_kernel&lt;/span>(&lt;span style="color:#000">x_ptr&lt;/span>, &lt;span style="color:#000">y_ptr&lt;/span>, &lt;span style="color:#000">output_ptr&lt;/span>, &lt;span style="color:#000">N&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">BLOCK_SIZE&lt;/span>: &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">constexpr&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">pid&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">program_id&lt;/span>(&lt;span style="color:#3af">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">block_start&lt;/span> = &lt;span style="color:#000">pid&lt;/span> * &lt;span style="color:#000">BLOCK_SIZE&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offsets&lt;/span> = &lt;span style="color:#000">block_start&lt;/span> + &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">arange&lt;/span>(&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#000">BLOCK_SIZE&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">mask&lt;/span> = &lt;span style="color:#000">offsets&lt;/span> &amp;lt; &lt;span style="color:#000">N&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">x&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">load&lt;/span>(&lt;span style="color:#000">x_ptr&lt;/span> + &lt;span style="color:#000">offsets&lt;/span>, &lt;span style="color:#000">mask&lt;/span>=&lt;span style="color:#000">mask&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">y&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">load&lt;/span>(&lt;span style="color:#000">y_ptr&lt;/span> + &lt;span style="color:#000">offsets&lt;/span>, &lt;span style="color:#000">mask&lt;/span>=&lt;span style="color:#000">mask&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">output&lt;/span> = &lt;span style="color:#000">x&lt;/span> + &lt;span style="color:#000">y&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">store&lt;/span>(&lt;span style="color:#000">output_ptr&lt;/span>+&lt;span style="color:#000">offsets&lt;/span>, &lt;span style="color:#000">output&lt;/span>, &lt;span style="color:#000">mask&lt;/span>=&lt;span style="color:#000">mask&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># x, y are torch.Tensor&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">grid&lt;/span> = &lt;span style="color:#00f">lambda&lt;/span> &lt;span style="color:#000">meta&lt;/span>: (&lt;span style="color:#000">triton&lt;/span>.&lt;span style="color:#000">cdiv&lt;/span>(&lt;span style="color:#000">n_elements&lt;/span>, &lt;span style="color:#000">meta&lt;/span>[&lt;span style="color:#5a2">&amp;#39;BLOCK_SIZE&amp;#39;&lt;/span>]),)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">add_kernel&lt;/span>[&lt;span style="color:#000">grid&lt;/span>](&lt;span style="color:#000">x&lt;/span>, &lt;span style="color:#000">y&lt;/span>, &lt;span style="color:#000">output&lt;/span>, &lt;span style="color:#000">n_elements&lt;/span>, &lt;span style="color:#000">BLOCK_SIZE&lt;/span>=&lt;span style="color:#3af">1024&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>相应会得到 Triton IR&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@kernel_0d1d2d3d&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c256_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">256&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%0&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">get_program_id&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%1&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%0&lt;/span>, &lt;span style="color:#000">%c256_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%2&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">256&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%3&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%1&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%4&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%3&lt;/span>, &lt;span style="color:#000">%2&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%5&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%6&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%5&lt;/span>, &lt;span style="color:#000">%4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%7&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg1&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%8&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%7&lt;/span>, &lt;span style="color:#000">%4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%9&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg3&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%10&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">cmpi&lt;/span> &lt;span style="color:#00f">slt&lt;/span>, &lt;span style="color:#000">%4&lt;/span>, &lt;span style="color:#000">%9&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%11&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%6&lt;/span>, &lt;span style="color:#000">%10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%12&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%8&lt;/span>, &lt;span style="color:#000">%10&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%13&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addf&lt;/span> &lt;span style="color:#000">%11&lt;/span>, &lt;span style="color:#000">%12&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%14&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg2&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%15&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%14&lt;/span>, &lt;span style="color:#000">%4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">store&lt;/span> &lt;span style="color:#000">%15&lt;/span>, &lt;span style="color:#000">%13&lt;/span>, &lt;span style="color:#000">%10&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">256&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看到，Triton IR 几乎一比一地对应到原始的 Python code，将用户定义的 computation 带入 MLIR 的体系，后续会在此基础上做各类优化（by Optimizer）以及最终 translate 到更低层次的表示中（by Backend）。&lt;/p>
&lt;h2 id="性能优化之-optimizer">性能优化之 Optimizer&lt;/h2>
&lt;p>Optimizer 用于分析和优化 Frontend 传入的 IR，通过各类 Transformation 和 Conversion (Pass) 策略，最终传递给 Backend 做 translate。&lt;/p>
&lt;p>Optimizer 大致的 workflow 如下&lt;/p>
&lt;figure>&lt;img src="/static/triton-publish/optimizer.png"/>
&lt;/figure>
&lt;p>主要分为三大块优化&lt;/p>
&lt;ol>
&lt;li>TritonIR 的优化&lt;/li>
&lt;li>TritonIR to TritonGPU IR 的 Conversion&lt;/li>
&lt;li>TritonGPU IR 的优化&lt;/li>
&lt;/ol>
&lt;p>贯穿中间的数据结构是 TritonGPU IR，顾名思义是带上了 GPU 相关的信息的 IR。&lt;/p>
&lt;h3 id="tritongpu-dialect">TritonGPU Dialect&lt;/h3>
&lt;p>TritonGPU Dialect 相比 Triton Dialect，主要是增加了 GPU 硬件相关的 Op 和 Type。&lt;/p>
&lt;p>相关的主要 Op 如下&lt;/p>
&lt;ol>
&lt;li>&lt;code>async_wait(N:int) -&amp;gt; ()&lt;/code>, 直接对应到 PTX 中的 &lt;code>cp.async.wait_group N&lt;/code> 指令&lt;/li>
&lt;li>&lt;code>alloc_tensor()-&amp;gt;Tensor&lt;/code> , 表明 allocate 一个处于 shared memory 的 tensor&lt;/li>
&lt;li>&lt;code>insert_slice_async(slice:PtrTensor, dst:Tensor, index:int, mask:i1 ...) -&amp;gt; Tensor&lt;/code>, 表明往 （alloc_tensor op 产生的，shared memory中的) tensor 中 insert 一个 slice，并且这个操作是 async 的&lt;/li>
&lt;li>&lt;code>convert_layout(src:Tensor)-&amp;gt;Tensor&lt;/code> ，转换 Tensor 中的 data layout&lt;/li>
&lt;/ol>
&lt;p>前三个 Op 主要在 Pipeline 和 Prefetch 的优化（下文 Pass 中会涉及）中用到， &lt;code>convert_layout&lt;/code> Op 在 TritonGPU Dialect 中的 Type system 比较关键，以下两个小节会重点详解。&lt;/p>
&lt;h4 id="data-layout">Data layout&lt;/h4>
&lt;p>Data layout 是 TritonGPU Dialect 的 Type system 的关键，确定了 Data(各层级memory中的Tensor) 到 thread 之间的映射关系。&lt;/p>
&lt;p>目前 Triton 中有如下几种&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>
&lt;ol>
&lt;li>Blocked Layout&lt;/li>
&lt;/ol>
&lt;p>Blocked Layout 表示 thread 间平均分配 workload 的情况，每个线程 own 一块 memory 上连续的 data 进行处理。&lt;/p>
&lt;p>其包含了如下三个字段用于帮助确定 thread 和数据之间的映射关系：&lt;/p>
&lt;ul>
&lt;li>sizePerThread：每个 thread 处理的 &lt;strong>连续排布&lt;/strong> 的元素数目&lt;/li>
&lt;li>threadsPerWarp：每个 Warp 在不同维度上的线程数，用向量表示&lt;/li>
&lt;li>warpsPerCTA：每个 CTA 对应的 Warp 数目，这个由用户在 Python 层制定&lt;/li>
&lt;/ul>
&lt;p>按代码中的例子&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-nil" data-lang="nil">For example, a row-major coalesced layout may partition a 16x16 tensor over 2 warps (i.e. 64 threads) as follows.
[ 0 0 1 1 2 2 3 3 ; 32 32 33 33 34 34 35 35 ]
[ 0 0 1 1 2 2 3 3 ; 32 32 33 33 34 34 35 35 ]
[ 4 4 5 5 6 6 7 7 ; 36 36 37 37 38 38 39 39 ]
[ 4 4 5 5 6 6 7 7 ; 36 36 37 37 38 38 39 39 ]
...
[ 28 28 29 29 30 30 31 31 ; 60 60 61 61 62 62 63 63 ]
[ 28 28 29 29 30 30 31 31 ; 60 60 61 61 62 62 63 63 ]
for
#triton_gpu.blocked_layout&amp;lt;{
sizePerThread = {2, 2}
threadsPerWarp = {8, 4}
warpsPerCTA = {1, 2}
}&amp;gt;
&lt;/code>&lt;/pre>&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>
&lt;ol start="2">
&lt;li>Shared Layout&lt;/li>
&lt;/ol>
&lt;p>Shared Layout：表示数据在 shared memory 的一些特性，比如 swizzle 访问的一些参数。&lt;/p>
&lt;p>其包含了如下字段&lt;/p>
&lt;ul>
&lt;li>vec, 支持 vectorization 的单位&lt;/li>
&lt;li>perPhase, 每个 phase 包含多少个 vec&lt;/li>
&lt;li>maxPhase, tensor 总共包含多少个 phase&lt;/li>
&lt;li>order, axis 的次序&lt;/li>
&lt;/ul>
&lt;p>其中，vec, perPhase, maxPhase 是用于避免 bank conflict 的 swizzle 操作需要的参数。&lt;/p>
&lt;p>代码中的例子：&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-nil" data-lang="nil">In order to avoid shared memory bank conflicts, elements may be swizzled
in memory. For example, a swizzled row-major layout could store its data
as follows:
A_{0, 0} A_{0, 1} A_{0, 2} A_{0, 3} ... [phase 0] \ per_phase = 2
A_{1, 0} A_{1, 1} A_{1, 2} A_{1, 3} ... [phase 0] /
groups of vec=2 elements
are stored contiguously
_ _ _ _ /\_ _ _ _
A_{2, 2} A_{2, 3} A_{2, 0} A_{2, 1} ... [phase 1] \ per phase = 2
A_{3, 2} A_{3, 3} A_{3, 0} A_{3, 1} ... [phase 1] /
&lt;/code>&lt;/pre>&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>
&lt;ol start="3">
&lt;li>MMA Layout&lt;/li>
&lt;/ol>
&lt;p>顾名思义，MMA Layout 表示 Tensor Core 中 MMA 指令结果的 data layout，比如 Ampere 对应的 MMA Layout 的数据排布基本可以对应到 PTX 指令中的 &lt;a href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#warp-level-matrix-fragment-mma-1684">mma.m16n8k16&lt;/a> 的 C,D 的排布。&lt;/p>
&lt;p>MMA Layout 主要包含两个字段：&lt;/p>
&lt;ul>
&lt;li>&lt;code>version&lt;/code> ，表示 TensorCore 的版本
&lt;ul>
&lt;li>1 为 Volta&lt;/li>
&lt;li>2 为 Ampere&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>warpsPerCTA&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>这里演示 FP16 精度下， &lt;code>version=2&lt;/code> 的数据排布（会映射到 &lt;code>mma.m16n8k16&lt;/code> 指令）的 Accumulators (C or D) 的 &lt;a href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#warp-level-matrix-fragment-mma-16816-float">数据排布&lt;/a>。&lt;/p>
&lt;figure>&lt;img src="/static/mma.16816.png"/>
&lt;/figure>
&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>
&lt;ol start="4">
&lt;li>DotOperand Layout&lt;/li>
&lt;/ol>
&lt;p>DotOperand Layout 用来表示 Triton 的 DotOp 的输入的 layout。&lt;/p>
&lt;p>其主要包含如下信息&lt;/p>
&lt;ol>
&lt;li>&lt;code>opIdx&lt;/code> ， Operand 的 ID
&lt;ul>
&lt;li>&lt;code>opIdx=0&lt;/code> 表示 DotOp 的 $a&lt;/li>
&lt;li>&lt;code>opIdx=1&lt;/code> 表示 DotOp 的 $b&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>parent&lt;/code> ，存储其对应的 MMA Layout，这里 DotOperand 的数据排布也可能间接的由 MMA Layout 确定（如果 DotOp lower 到 MMA 指令）或者 Blocked Layout（如果 DotOp lower 到 FMA 指令）&lt;/li>
&lt;/ol>
&lt;p>这里为了方便演示，我们采用 MMA Layout 中的 &lt;code>mma.m16n8k16.f16&lt;/code> 指令&lt;/p>
&lt;ul>
&lt;li>
&lt;p>计算精度为 FP16&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MMA Layout&lt;/p>
&lt;ul>
&lt;li>&lt;code>version=2&lt;/code>&lt;/li>
&lt;li>&lt;code>warpsPerCTA=[8,4]&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>对于 $a，对应的 DotOperand 的 opIdx = 0&lt;/p>
&lt;/li>
&lt;li>
&lt;p>$b, 对应的 DotOperand 的 opIdx = 1&lt;/p>
&lt;figure>&lt;img src="/static/mma.16816.op.png"/>
&lt;/figure>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;ul>
&lt;li>
&lt;ol start="5">
&lt;li>Slice Layout&lt;/li>
&lt;/ol>
&lt;p>Slice Layout 表明单个维度上的数据反向索引&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="convertlayoutop">ConvertLayoutOp&lt;/h4>
&lt;p>顾名思义，ConvertLayoutOp 就是用来讲 Tensor 从一种 data layout 转换到另外一种 data layout。
由于 data layout 是 TensorType 的一部分，很自然会存在类型（其中layout）需要转换的情况，这就是 ConvertLayoutOp 的作用。&lt;/p>
&lt;p>有了上面的 Data Layout，接下来我们看最简单的 MatMul 中的的 IR：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">2&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">4&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#mma&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">mma&lt;/span>&amp;lt;{&lt;span style="color:#f00">version&lt;/span> = &lt;span style="color:#3af">2&lt;/span>, &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">//&lt;/span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">%37&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg8&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">%38&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg9&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">%39&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%37&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">%40&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%38&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">%41&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%39&lt;/span>, &lt;span style="color:#000">%40&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">//&lt;/span> ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上面是截取了一段经典 MatMul 中某个阶段的 TritonGPU IR，逻辑比较直白，定义了 &lt;code>#blocked0&lt;/code>, &lt;code>#blocked1&lt;/code> 和 &lt;code>#mma&lt;/code> 三种 layout，之后通过 &lt;code>tt.load&lt;/code> 将 DotOp 的两个 Operand 从 GEMM 加载数据到 register files，之后两个 &lt;code>triton_gpu.convert_layout&lt;/code> 转换 layout 为 DotOp 的参数需要的 &lt;code>#triton_gpu.dot_op&lt;/code> layout。&lt;/p>
&lt;p>这里列举一些典型的 data layout 的转换，以及特点：&lt;/p>
&lt;ul>
&lt;li>&lt;code>#shared -&amp;gt; #blocked&lt;/code> ，正常是代表数据从 shared memory 被 load 到 register file 中，需要考虑 swizzle&lt;/li>
&lt;li>&lt;code>#blocked -&amp;gt; #shared&lt;/code> ，代表数据从 register file 存储到 shared memory 中，需要上一步相同的 swizzle 方式&lt;/li>
&lt;li>&lt;code>#mma -&amp;gt; #blocked&lt;/code> ，正常是 DotOp 的输出转换为更简单的 layout 来进一步计算，由于涉及到跨 thread 间的数据传递，因此一般会借由 shared memory 中转一次&lt;/li>
&lt;li>&lt;code>#blocked -&amp;gt; #dot_operand&lt;/code> ，转换为 DotOp 的输入，这一步可能也需要 shared memory 中转&lt;/li>
&lt;/ul>
&lt;p>Triton 中几乎实现了任意 data layout 间的转换，当然不同的转换代价也不尽相同（考虑到是否会用到 shared memory，register 增减量等等），因此转换的代价也会在 Optimizer 里面一并考虑。&lt;/p>
&lt;h3 id="tritonir-的优化">TritonIR 的优化&lt;/h3>
&lt;p>TritonIR 上的优化主要是计算本身的，与硬件无关的优化，包含了如下 Pass&lt;/p>
&lt;ul>
&lt;li>Inliner Pass，将 Kernel Call 的子函数 Inline 展开&lt;/li>
&lt;li>Combine Pass，一些特定的 Pattern rewrite，比如
&lt;ul>
&lt;li>&lt;code>select(cond, load(ptrs, broadcast(cond), ???), other) =&amp;gt; load(ptrs, broadcast(cond), other)&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Canonicalizer Pass，一些化简的 Pattern rewrite&lt;/li>
&lt;li>CSE Pass，MLIR 的 &lt;a href="https://mlir.llvm.org/docs/Passes/#-cse-eliminate-common-sub-expressions">cse&lt;/a> Pass，用于 Eliminate common sub-expressions&lt;/li>
&lt;li>LICM Pass，MLIR 的 &lt;a href="https://mlir.llvm.org/doxygen/LoopInvariantCodeMotion_8cpp_source.html">LoopInvariantCodeMotion Pass&lt;/a> ，将循环无关的变量挪到 forloop 外面&lt;/li>
&lt;/ul>
&lt;h3 id="tritongpu-ir-的优化">TritonGPU IR 的优化&lt;/h3>
&lt;p>TritonGPU IR 上的优化在计算本身优化外，新增了 GPU 硬件相关的优化，具体的 Pass 列表如下&lt;/p>
&lt;ul>
&lt;li>ConvertTritonToTritonGPU Pass，将 Triton IR 转换为 TritonGPU IR，主要是增加 TritonGPU 特有的 layout&lt;/li>
&lt;li>Coalesce Pass，重排 order，使得最大 contiguity 的维度排在最前面&lt;/li>
&lt;li>Combine Pass，同 Triton IR&lt;/li>
&lt;li>Pipeline Pass，MMA 指令对应的 global memory 到 shared memory 的 N-Buffer 优化，下文详解&lt;/li>
&lt;li>Prefetch Pass，MMA 指令对应的 shared memory 到 register file 的 N-Buffer 优化，下文详解&lt;/li>
&lt;li>Canonicalizer，同 Triton IR&lt;/li>
&lt;li>CSE Pass，同 Triton IR&lt;/li>
&lt;li>LICM Pass，同 Triton IR&lt;/li>
&lt;/ul>
&lt;h4 id="pipeline-pass">Pipeline Pass&lt;/h4>
&lt;p>Pipeline Pass 和下一小节中的 Prefetch Pass 是配合关系，整体用来为 DotOp (mma 指令) 的 Operand 提供 IO 优化。&lt;/p>
&lt;p>Pipeline 优化主要针对 DotOp 中 GEMM 到 SMEM 之间的数据拷贝，并自动做 Double Buffer 或者 N Buffer 的优化。&lt;/p>
&lt;p>最简单的 Double buffer 的伪代码如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">A&lt;/span> = &lt;span style="color:#000">alloc_tensor&lt;/span>(&lt;span style="color:#000">shape&lt;/span>=[&lt;span style="color:#3af">2&lt;/span>*&lt;span style="color:#3af">16&lt;/span>,&lt;span style="color:#3af">16&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># cp.async &amp;amp; cp.async.commit_group&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">A&lt;/span> = &lt;span style="color:#000">insert_slice_async&lt;/span>(&lt;span style="color:#000">A&lt;/span>, &lt;span style="color:#000">ptr0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">B&lt;/span> = &lt;span style="color:#000">alloc_tensor&lt;/span>(&lt;span style="color:#000">shape&lt;/span>=[&lt;span style="color:#3af">2&lt;/span>*&lt;span style="color:#3af">16&lt;/span>,&lt;span style="color:#3af">8&lt;/span>])
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">B&lt;/span> = &lt;span style="color:#000">insert_slice_async&lt;/span>(&lt;span style="color:#000">B&lt;/span>, &lt;span style="color:#000">ptr1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">A&lt;/span> = &lt;span style="color:#000">insert_slice_async&lt;/span>(&lt;span style="color:#000">A&lt;/span>, &lt;span style="color:#000">ptr00&lt;/span>, &lt;span style="color:#3af">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">B&lt;/span> = &lt;span style="color:#000">insert_slice_async&lt;/span>(&lt;span style="color:#000">B&lt;/span>, &lt;span style="color:#000">ptr11&lt;/span>, &lt;span style="color:#3af">0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">async_wait&lt;/span>(&lt;span style="color:#000">num&lt;/span>=&lt;span style="color:#3af">2&lt;/span>) &lt;span style="color:#888;font-style:italic"># cp.async.wait_group&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">A_slice0&lt;/span> = &lt;span style="color:#000">extract_slice&lt;/span>(&lt;span style="color:#000">A&lt;/span>, &lt;span style="color:#000">offset&lt;/span>=(&lt;span style="color:#3af">0&lt;/span>,&lt;span style="color:#3af">0&lt;/span>,&lt;span style="color:#3af">0&lt;/span>), &lt;span style="color:#000">size&lt;/span>=(&lt;span style="color:#3af">1&lt;/span>,&lt;span style="color:#3af">16&lt;/span>,&lt;span style="color:#3af">16&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">B_slice0&lt;/span> = &lt;span style="color:#000">extract_slice&lt;/span>(&lt;span style="color:#000">B&lt;/span>, &lt;span style="color:#000">offset&lt;/span>=(&lt;span style="color:#3af">0&lt;/span>,&lt;span style="color:#3af">0&lt;/span>,&lt;span style="color:#3af">0&lt;/span>), &lt;span style="color:#000">size&lt;/span>=(&lt;span style="color:#3af">1&lt;/span>,&lt;span style="color:#3af">16&lt;/span>,&lt;span style="color:#3af">8&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">for&lt;/span> &lt;span style="color:#000">i&lt;/span> &lt;span style="color:#00f">in&lt;/span> &lt;span style="color:#000">range&lt;/span>(...):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">a&lt;/span> = &lt;span style="color:#000">ldmatrix&lt;/span>(&lt;span style="color:#000">A_slice0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">b&lt;/span> = &lt;span style="color:#000">ldmatrix&lt;/span>(&lt;span style="color:#000">B_slice0&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">c&lt;/span> = &lt;span style="color:#000">dot&lt;/span>(&lt;span style="color:#000">a&lt;/span>, &lt;span style="color:#000">b&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offset&lt;/span> = (&lt;span style="color:#000">i&lt;/span>+&lt;span style="color:#3af">1&lt;/span>) % &lt;span style="color:#3af">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">A&lt;/span> = &lt;span style="color:#000">insert_slice_async&lt;/span>(&lt;span style="color:#000">A&lt;/span>, &lt;span style="color:#000">ptr2&lt;/span>, &lt;span style="color:#000">offset&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">B&lt;/span> = &lt;span style="color:#000">insert_slice_async&lt;/span>(&lt;span style="color:#000">B&lt;/span>, &lt;span style="color:#000">ptr3&lt;/span>, &lt;span style="color:#000">offset&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">async_wait&lt;/span>(&lt;span style="color:#000">num&lt;/span>=&lt;span style="color:#3af">2&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">A_slice0&lt;/span> = &lt;span style="color:#000">extract_slice&lt;/span>(&lt;span style="color:#000">A&lt;/span>, &lt;span style="color:#000">offset&lt;/span>=(&lt;span style="color:#000">offset&lt;/span>,&lt;span style="color:#3af">0&lt;/span>,&lt;span style="color:#3af">0&lt;/span>), &lt;span style="color:#000">size&lt;/span>=(&lt;span style="color:#3af">1&lt;/span>,&lt;span style="color:#3af">16&lt;/span>,&lt;span style="color:#3af">16&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">B_slice0&lt;/span> = &lt;span style="color:#000">extract_slice&lt;/span>(&lt;span style="color:#000">B&lt;/span>, &lt;span style="color:#000">offset&lt;/span>=(&lt;span style="color:#000">offset&lt;/span>,&lt;span style="color:#3af">0&lt;/span>,&lt;span style="color:#3af">0&lt;/span>), &lt;span style="color:#000">size&lt;/span>=(&lt;span style="color:#3af">1&lt;/span>,&lt;span style="color:#3af">16&lt;/span>,&lt;span style="color:#3af">8&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中，&lt;/p>
&lt;ul>
&lt;li>&lt;code>alloc_tensor&lt;/code> 大致对应到 &lt;code>triton_gpu.alloc_tensor&lt;/code>&lt;/li>
&lt;li>&lt;code>insert_slice_async&lt;/code> 对应到 &lt;code>triton_gpu.insert_slice_async&lt;/code> ， 表示异步地向 Tensor 中插入一个 slice，这个过程是通过 &lt;code>cp.async&lt;/code> 指令实现的异步&lt;/li>
&lt;li>&lt;code>tensor.extract_slice&lt;/code> 表示从 Tensor 中读取一个 slice&lt;/li>
&lt;li>&lt;code>async_wait&lt;/code> 的语义对应到 &lt;code>cp.async.wait_group&lt;/code> 指令&lt;/li>
&lt;/ul>
&lt;h4 id="prefetch-pass">Prefetch Pass&lt;/h4>
&lt;p>Prefetch 的逻辑跟 Pipeline Pass 基本类似，也是 Double buffer 和 N Buffer 的优化，区别是其承担了 SMEM 到 register file 的数据搬运，IR 的表示方式是 &lt;code>triton_gpu.convert_layout %37 : (tensor&amp;lt;16x16xf16, #blocked0&amp;gt;) -&amp;gt; tensor&amp;lt;16x16xf16, #triton_gpu.dot_op&amp;lt;{opIdx = 0, parent = #mma}&amp;gt;&amp;gt;&lt;/code> ， 最终映射的核心指令是 &lt;code>ldmatrix&lt;/code> 。&lt;/p>
&lt;h2 id="高性能-llvm-生成之-backend">高性能 LLVM 生成之 Backend&lt;/h2>
&lt;p>Triton 的 Backend 可以有微观和宏观两个角度&lt;/p>
&lt;ul>
&lt;li>微观上主要包括 &lt;code>TritonGPU IR -&amp;gt; LLVM Dialect&lt;/code> 的过程，这里需要注意的是，&lt;a href="https://mlir.llvm.org/docs/Dialects/LLVM/">LLVM Dialect&lt;/a> 是 MLIR 体系中的一个表示，其可以进一步自动 lower 到 LLVM IR&lt;/li>
&lt;li>宏观上进一步包括了 LLVM Dialect -&amp;gt; LLVM IR -&amp;gt; PTX -&amp;gt; cubin 等过程&lt;/li>
&lt;/ul>
&lt;p>这里我们只从微观角度介绍，因为宏观角度中，大部分流程可以通过 LLVM 社区或者 CUDA 的一些设施自动完成。&lt;/p>
&lt;p>Triton 的 Backend 是比较经典的 MLIR 的 Lowering，主要内容就是将 TritonGPU IR 中包含的每种 Op 逐个的 OpConversion。 不过为了高性能，以及保证 Codegen 产物的可控，Triton 在 LLVM 中大量插入了 PTX 的内联汇编（下文会介绍）。 此外，大部分 Op 的 Lowering 都是比较规则化，下文会简要介绍 Dot 指令的 Lowering。&lt;/p>
&lt;h3 id="ptx-inline-asm">PTX inline asm&lt;/h3>
&lt;p>Triton 中使用 Inline asm 大致几个原因：&lt;/p>
&lt;ul>
&lt;li>一些指令对应的操作在现有的 &lt;code>gpu&lt;/code> 和 &lt;code>nvgpu&lt;/code> 的 dialect 还不太完善&lt;/li>
&lt;li>性能原因，比如浮点类型间的变换，一小块汇编足以&lt;/li>
&lt;/ul>
&lt;p>Triton 里面针对 Inline asm 的封装有个简单的 wrapper，类似最简单的 &lt;code>cp.async.wait_group&lt;/code> 的调用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">PTXBuilder&lt;/span> &lt;span style="color:#000">ptxBuilder&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">auto&lt;/span> &amp;amp;&lt;span style="color:#000">asyncWaitOp&lt;/span> = *&lt;span style="color:#000">ptxBuilder&lt;/span>.&lt;span style="color:#000">create&lt;/span>&amp;lt;&amp;gt;(&lt;span style="color:#5a2">&amp;#34;cp.async.wait_group&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">auto&lt;/span> &lt;span style="color:#000">num&lt;/span> = &lt;span style="color:#000">op&lt;/span>-&amp;gt;&lt;span style="color:#000">getAttrOfType&lt;/span>&amp;lt;&lt;span style="color:#000">IntegerAttr&lt;/span>&amp;gt;(&lt;span style="color:#5a2">&amp;#34;num&amp;#34;&lt;/span>).&lt;span style="color:#000">getInt&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">asyncWaitOp&lt;/span>(&lt;span style="color:#000">ptxBuilder&lt;/span>.&lt;span style="color:#000">newConstantOperand&lt;/span>(&lt;span style="color:#000">num&lt;/span>));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>到稍微复杂点的 &lt;code>ld&lt;/code> 的各种参数组合&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">auto&lt;/span> &amp;amp;&lt;span style="color:#000">ld&lt;/span> = &lt;span style="color:#000">ptxBuilder&lt;/span>.&lt;span style="color:#000">create&lt;/span>&amp;lt;&amp;gt;(&lt;span style="color:#5a2">&amp;#34;ld&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -&amp;gt;&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#5a2">&amp;#34;volatile&amp;#34;&lt;/span>, &lt;span style="color:#000">op&lt;/span>.&lt;span style="color:#000">getIsVolatile&lt;/span>())
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">global&lt;/span>()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#5a2">&amp;#34;ca&amp;#34;&lt;/span>, &lt;span style="color:#000">op&lt;/span>.&lt;span style="color:#000">getCache&lt;/span>() == &lt;span style="color:#000">triton&lt;/span>::&lt;span style="color:#000">CacheModifier&lt;/span>::&lt;span style="color:#000">CA&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#5a2">&amp;#34;cg&amp;#34;&lt;/span>, &lt;span style="color:#000">op&lt;/span>.&lt;span style="color:#000">getCache&lt;/span>() == &lt;span style="color:#000">triton&lt;/span>::&lt;span style="color:#000">CacheModifier&lt;/span>::&lt;span style="color:#000">CG&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#5a2">&amp;#34;L1::evict_first&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">op&lt;/span>.&lt;span style="color:#000">getEvict&lt;/span>() == &lt;span style="color:#000">triton&lt;/span>::&lt;span style="color:#000">EvictionPolicy&lt;/span>::&lt;span style="color:#000">EVICT_FIRST&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#5a2">&amp;#34;L1::evict_last&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">op&lt;/span>.&lt;span style="color:#000">getEvict&lt;/span>() == &lt;span style="color:#000">triton&lt;/span>::&lt;span style="color:#000">EvictionPolicy&lt;/span>::&lt;span style="color:#000">EVICT_LAST&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#5a2">&amp;#34;L1::cache_hint&amp;#34;&lt;/span>, &lt;span style="color:#000">hasL2EvictPolicy&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">v&lt;/span>(&lt;span style="color:#000">nWords&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">b&lt;/span>(&lt;span style="color:#000">width&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="mma-指令生成">MMA 指令生成&lt;/h3>
&lt;p>相比于 ReduceOp 等需要跟 layout 结合的 Op 的 Lowering，DotOp 的是规则非常清晰的。&lt;/p>
&lt;p>这里大致提下在 Backend，一个 Dot 的工作流涉及的阶段和 Op：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>Stage&lt;/th>
&lt;th>Op&lt;/th>
&lt;th>Layout&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>Load &lt;code>$a&lt;/code>, &lt;code>$b&lt;/code> 的 tile 到 SMEM&lt;/td>
&lt;td>&lt;code>triton_gpu.insert_slice_async&lt;/code>&lt;/td>
&lt;td>&lt;code>#shared&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&lt;/td>
&lt;td>从 SMEM Load 参数到 Register file&lt;/td>
&lt;td>&lt;code>tensor.extract_slice&lt;/code>&lt;/td>
&lt;td>&lt;code>#dot_op&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&lt;/td>
&lt;td>执行 MMA，结果会在 Registter file&lt;/td>
&lt;td>&lt;code>tt.dot&lt;/code>&lt;/td>
&lt;td>&lt;code>#mma&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>所以直接跟 MMA 指令相关的其实只在第 4 步，其需要的 \(a\), \(b\) 两个参数已经通过 &lt;code>tensor.extract_slice&lt;/code> 拷贝到了 Register file，直接满足了 Ampere 上的 &lt;code>mma&lt;/code> 指令的需求。&lt;/p>
&lt;p>在 Ampere 架构上，一个 DotOp 会映射到多个 mma 指令，下面我们以 FP16 的 &lt;a href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#warp-level-matrix-fragment-mma-16816-float">mma.m16n8k16&lt;/a> 指令为例，具体的任务设置如下&lt;/p>
&lt;ul>
&lt;li>Dot 计算的 tile 的尺寸是 M=32, N=16, K=16
&lt;ul>
&lt;li>对应着 &lt;code>mma.m16n8k16&lt;/code> 指令的尺寸是 &lt;code>M=16, N=8, K=16&lt;/code> ，因此一个 tile 需要在 m, n, k 方向展开 &lt;code>2x2x1&lt;/code> 总共 4 个 &lt;code>mma.m16n8k16&lt;/code> 指令&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>最终会有类似如下的代码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">for&lt;/span> (&lt;span style="color:#00f">unsigned&lt;/span> &lt;span style="color:#000">k&lt;/span> = &lt;span style="color:#3af">0&lt;/span>; &lt;span style="color:#000">k&lt;/span> &amp;lt; &lt;span style="color:#000">numK&lt;/span>; ++&lt;span style="color:#000">k&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">for&lt;/span> (&lt;span style="color:#00f">unsigned&lt;/span> &lt;span style="color:#000">m&lt;/span> = &lt;span style="color:#3af">0&lt;/span>; &lt;span style="color:#000">m&lt;/span> &amp;lt; &lt;span style="color:#000">numM&lt;/span>; ++&lt;span style="color:#000">m&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">for&lt;/span> (&lt;span style="color:#00f">unsigned&lt;/span> &lt;span style="color:#000">n&lt;/span> = &lt;span style="color:#3af">0&lt;/span>; &lt;span style="color:#000">n&lt;/span> &amp;lt; &lt;span style="color:#000">numN&lt;/span>; ++&lt;span style="color:#000">n&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">callMMA&lt;/span>(&lt;span style="color:#000">m&lt;/span>, &lt;span style="color:#000">n&lt;/span>, &lt;span style="color:#000">k&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中，numM, numN, numK 就对应着上面的 2, 2, 1。&lt;/p>
&lt;p>callMMA 的代码如上文时候 InlineAsm，类似如下代码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-C++" data-lang="C++">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">auto&lt;/span> &lt;span style="color:#000">mma&lt;/span> = &lt;span style="color:#000">builder&lt;/span>.&lt;span style="color:#000">create&lt;/span>(&lt;span style="color:#5a2">&amp;#34;mma.sync.aligned.m8n8k4&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> -&amp;gt;&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#000">isARow&lt;/span> ? &lt;span style="color:#5a2">&amp;#34;row&amp;#34;&lt;/span> : &lt;span style="color:#5a2">&amp;#34;col&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#000">isBRow&lt;/span> ? &lt;span style="color:#5a2">&amp;#34;row&amp;#34;&lt;/span> : &lt;span style="color:#5a2">&amp;#34;col&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> .&lt;span style="color:#000">o&lt;/span>(&lt;span style="color:#5a2">&amp;#34;f32.f16.f16.f32&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">mma&lt;/span>(&lt;span style="color:#000">resOprs&lt;/span>, &lt;span style="color:#000">AOprs&lt;/span>, &lt;span style="color:#000">BOprs&lt;/span>, &lt;span style="color:#000">COprs&lt;/span>);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="fyi">FYI&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/openai/triton/tree/ca05ef8e5b0b4d4834957bc31e7581b09d35c530">Triton MLIR migration code&lt;/a>&lt;/li>
&lt;li>Triton paper: &lt;a href="https://www.eecs.harvard.edu/~htk/publication/2019-mapl-tillet-kung-cox.pdf">Triton: An Intermediate Language and Compiler forTiled Neural Network Computations&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="gemm-在-optimizer-pass-效果">GEMM 在 Optimizer Pass 效果&lt;/h3>
&lt;p>下面列举了经典的 GEMM 在 Triton 的 Compile pipeline 里面的 IR 的变换。&lt;/p>
&lt;h4 id="python-code">Python code&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">def&lt;/span> &lt;span style="color:#000">matmul_kernel&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">a_ptr&lt;/span>, &lt;span style="color:#000">b_ptr&lt;/span>, &lt;span style="color:#000">c_ptr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">stride_am&lt;/span>, &lt;span style="color:#000">stride_ak&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">stride_bk&lt;/span>, &lt;span style="color:#000">stride_bn&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">stride_cm&lt;/span>, &lt;span style="color:#000">stride_cn&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">M&lt;/span>: &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">constexpr&lt;/span>, &lt;span style="color:#000">N&lt;/span>: &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">constexpr&lt;/span>, &lt;span style="color:#000">K&lt;/span>: &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">constexpr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">BLOCK_SIZE_M&lt;/span>: &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">constexpr&lt;/span>, &lt;span style="color:#000">BLOCK_SIZE_N&lt;/span>: &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">constexpr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">BLOCK_SIZE_K&lt;/span>: &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">constexpr&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offs_m&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">arange&lt;/span>(&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#000">BLOCK_SIZE_M&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offs_n&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">arange&lt;/span>(&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#000">BLOCK_SIZE_N&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">offs_k&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">arange&lt;/span>(&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#000">BLOCK_SIZE_K&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">a_ptrs&lt;/span> = &lt;span style="color:#000">a_ptr&lt;/span> + &lt;span style="color:#000">offs_m&lt;/span>[:, &lt;span style="color:#00f">None&lt;/span>] * &lt;span style="color:#000">stride_am&lt;/span> + &lt;span style="color:#000">offs_k&lt;/span>[&lt;span style="color:#00f">None&lt;/span>, :] * &lt;span style="color:#000">stride_ak&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">b_ptrs&lt;/span> = &lt;span style="color:#000">b_ptr&lt;/span> + &lt;span style="color:#000">offs_k&lt;/span>[:, &lt;span style="color:#00f">None&lt;/span>] * &lt;span style="color:#000">stride_bk&lt;/span> + &lt;span style="color:#000">offs_n&lt;/span>[&lt;span style="color:#00f">None&lt;/span>, :] * &lt;span style="color:#000">stride_bn&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">accumulator&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">zeros&lt;/span>((&lt;span style="color:#000">BLOCK_SIZE_M&lt;/span>, &lt;span style="color:#000">BLOCK_SIZE_N&lt;/span>), &lt;span style="color:#000">dtype&lt;/span>=&lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">float32&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#00f">for&lt;/span> &lt;span style="color:#000">k&lt;/span> &lt;span style="color:#00f">in&lt;/span> &lt;span style="color:#000">range&lt;/span>(&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#000">K&lt;/span>, &lt;span style="color:#000">BLOCK_SIZE_K&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">a&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">load&lt;/span>(&lt;span style="color:#000">a_ptrs&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">b&lt;/span> = &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">load&lt;/span>(&lt;span style="color:#000">b_ptrs&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">accumulator&lt;/span> += &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">dot&lt;/span>(&lt;span style="color:#000">a&lt;/span>, &lt;span style="color:#000">b&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">a_ptrs&lt;/span> += &lt;span style="color:#000">BLOCK_SIZE_K&lt;/span> * &lt;span style="color:#000">stride_ak&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">b_ptrs&lt;/span> += &lt;span style="color:#000">BLOCK_SIZE_K&lt;/span> * &lt;span style="color:#000">stride_bk&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">c_ptrs&lt;/span> = &lt;span style="color:#000">c_ptr&lt;/span> + &lt;span style="color:#000">offs_m&lt;/span>[:, &lt;span style="color:#00f">None&lt;/span>] * &lt;span style="color:#000">stride_cm&lt;/span> + &lt;span style="color:#000">offs_n&lt;/span>[&lt;span style="color:#00f">None&lt;/span>, :] * &lt;span style="color:#000">stride_cn&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">tl&lt;/span>.&lt;span style="color:#000">store&lt;/span>(&lt;span style="color:#000">c_ptrs&lt;/span>, &lt;span style="color:#000">accumulator&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="triton-ir-translated-from-python-ast--and-after-inliner-ces-dot-dot-dot-passes">Triton IR translated from Python AST(and after Inliner, CES &amp;hellip; passes)&lt;/h4>
&lt;p>这一步算是 Python code 直接翻译到了 Triton IR.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c56c78c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">0.000000e+00&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c64&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst_0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%0&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%1&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">8&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%2&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%0&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%3&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg3&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%4&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%5&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%6&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%5&lt;/span>, &lt;span style="color:#000">%4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%7&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%0&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%8&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%6&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%9&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%7&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%10&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%8&lt;/span>, &lt;span style="color:#000">%9&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%11&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg4&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%12&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%11&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%13&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg1&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%14&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%13&lt;/span>, &lt;span style="color:#000">%12&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%15&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%1&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%16&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%14&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%17&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%15&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%18&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%16&lt;/span>, &lt;span style="color:#000">%17&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%19&lt;/span>&lt;span style="color:#f00">:&lt;/span>&lt;span style="color:#3af">3&lt;/span> = &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#00f">or&lt;/span> &lt;span style="color:#000">%arg6&lt;/span> = &lt;span style="color:#000">%c0&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">step&lt;/span> &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">iter_args&lt;/span>(&lt;span style="color:#000">%arg7&lt;/span> = &lt;span style="color:#000">%cst&lt;/span>, &lt;span style="color:#000">%arg8&lt;/span> = &lt;span style="color:#000">%10&lt;/span>, &lt;span style="color:#000">%arg9&lt;/span> = &lt;span style="color:#000">%18&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%26&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg8&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%27&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg9&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%28&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%29&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg8&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%30&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%arg4&lt;/span>, &lt;span style="color:#000">%c16_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%31&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%30&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%32&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg9&lt;/span>, &lt;span style="color:#000">%31&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">yield&lt;/span> &lt;span style="color:#000">%28&lt;/span>, &lt;span style="color:#000">%29&lt;/span>, &lt;span style="color:#000">%32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%20&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg5&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%21&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%20&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%22&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg2&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%23&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%22&lt;/span>, &lt;span style="color:#000">%21&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%24&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%23&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%25&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%24&lt;/span>, &lt;span style="color:#000">%17&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">store&lt;/span> &lt;span style="color:#000">%25&lt;/span>, &lt;span style="color:#000">%19&lt;/span>&lt;span style="color:#000">#0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ir-before-loopinvariantcodemotion">IR Before LoopInvariantCodeMotion&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c56c78c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">0.000000e+00&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c64&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst_0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%0&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%1&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">8&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%2&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%0&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%3&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg3&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%4&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%5&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%6&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%5&lt;/span>, &lt;span style="color:#000">%4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%7&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%0&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%8&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%6&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%9&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%7&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%10&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%8&lt;/span>, &lt;span style="color:#000">%9&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%11&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg4&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%12&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%11&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%13&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg1&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%14&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%13&lt;/span>, &lt;span style="color:#000">%12&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%15&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%1&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%16&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%14&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%17&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%15&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%18&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%16&lt;/span>, &lt;span style="color:#000">%17&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%19&lt;/span>&lt;span style="color:#f00">:&lt;/span>&lt;span style="color:#3af">3&lt;/span> = &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#00f">or&lt;/span> &lt;span style="color:#000">%arg6&lt;/span> = &lt;span style="color:#000">%c0&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">step&lt;/span> &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">iter_args&lt;/span>(&lt;span style="color:#000">%arg7&lt;/span> = &lt;span style="color:#000">%cst&lt;/span>, &lt;span style="color:#000">%arg8&lt;/span> = &lt;span style="color:#000">%10&lt;/span>, &lt;span style="color:#000">%arg9&lt;/span> = &lt;span style="color:#000">%18&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%26&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg8&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%27&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg9&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%28&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%29&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg8&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%30&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%arg4&lt;/span>, &lt;span style="color:#000">%c16_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%31&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%30&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%32&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg9&lt;/span>, &lt;span style="color:#000">%31&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">yield&lt;/span> &lt;span style="color:#000">%28&lt;/span>, &lt;span style="color:#000">%29&lt;/span>, &lt;span style="color:#000">%32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%20&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg5&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%21&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%20&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%22&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg2&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%23&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%22&lt;/span>, &lt;span style="color:#000">%21&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%24&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%23&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%25&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%24&lt;/span>, &lt;span style="color:#000">%17&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">store&lt;/span> &lt;span style="color:#000">%25&lt;/span>, &lt;span style="color:#000">%19&lt;/span>&lt;span style="color:#000">#0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看到&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%30&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%arg4&lt;/span>, &lt;span style="color:#000">%c16_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%31&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%30&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这段计算的输入分别是 function argument 和 constant，不依赖 forloop 内的变量，理论上可以挪出去。&lt;/p>
&lt;h4 id="ir-after-loopinvariantcodemotion">IR After LoopInvariantCodeMotion&lt;/h4>
&lt;p>LoopInvariantCodeMotion 是 MLIR 社区的一个 Pass，用于将无关 variable 计算挪到 forloop 外面，可以看到上小节里面的计算已经挪出去了。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c56c78c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">0.000000e+00&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c64&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst_0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%0&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%1&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">8&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%2&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%0&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%3&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg3&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%4&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%5&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%6&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%5&lt;/span>, &lt;span style="color:#000">%4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%7&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%0&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%8&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%6&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%9&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%7&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%10&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%8&lt;/span>, &lt;span style="color:#000">%9&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%11&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg4&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%12&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%11&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%13&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg1&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%14&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%13&lt;/span>, &lt;span style="color:#000">%12&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%15&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%1&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%16&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%14&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%17&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%15&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%18&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%16&lt;/span>, &lt;span style="color:#000">%17&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%19&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%arg4&lt;/span>, &lt;span style="color:#000">%c16_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%20&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%19&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%21&lt;/span>&lt;span style="color:#f00">:&lt;/span>&lt;span style="color:#3af">3&lt;/span> = &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#00f">or&lt;/span> &lt;span style="color:#000">%arg6&lt;/span> = &lt;span style="color:#000">%c0&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">step&lt;/span> &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">iter_args&lt;/span>(&lt;span style="color:#000">%arg7&lt;/span> = &lt;span style="color:#000">%cst&lt;/span>, &lt;span style="color:#000">%arg8&lt;/span> = &lt;span style="color:#000">%10&lt;/span>, &lt;span style="color:#000">%arg9&lt;/span> = &lt;span style="color:#000">%18&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%28&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg8&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%29&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg9&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%30&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%28&lt;/span>, &lt;span style="color:#000">%29&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%31&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg8&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%32&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg9&lt;/span>, &lt;span style="color:#000">%20&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">yield&lt;/span> &lt;span style="color:#000">%30&lt;/span>, &lt;span style="color:#000">%31&lt;/span>, &lt;span style="color:#000">%32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%22&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg5&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%23&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%2&lt;/span>, &lt;span style="color:#000">%22&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%24&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg2&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%25&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%24&lt;/span>, &lt;span style="color:#000">%23&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%26&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%27&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%17&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">store&lt;/span> &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%21&lt;/span>&lt;span style="color:#000">#0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ir-after-converttritontotritongpu">IR After ConvertTritonToTritonGPU&lt;/h4>
&lt;p>这一步是在原有的硬件无关的 Triton IR 基础上加入了 GPU 相关的 data layout 和 operation.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex; background-color:#e5e5e5">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">16&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">3&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">2&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">5&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">module&lt;/span> &lt;span style="color:#00f">attributes&lt;/span> {&lt;span style="color:#5a2">&amp;#34;triton_gpu.num-warps&amp;#34;&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c56c78c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">0.000000e+00&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">|\colorbo&lt;/span>&lt;span style="color:#00f">x&lt;/span>{&lt;span style="color:#f00">yellow&lt;/span>}{&lt;span style="color:#f00">\strut&lt;/span> &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>}&lt;span style="color:#f00">|&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c64&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst_0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%0&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%1&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">8&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%2&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%3&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%2&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%4&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg3&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%5&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%3&lt;/span>, &lt;span style="color:#000">%4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%6&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%7&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%6&lt;/span>, &lt;span style="color:#000">%5&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%8&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">3&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%9&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%8&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">3&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">3&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%10&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%7&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%11&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%10&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%12&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%9&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">3&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">3&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%13&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%12&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">3&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%14&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%11&lt;/span>, &lt;span style="color:#000">%13&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%15&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg4&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%16&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%3&lt;/span>, &lt;span style="color:#000">%15&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%17&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg1&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%18&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%17&lt;/span>, &lt;span style="color:#000">%16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%19&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%1&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">5&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%20&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%19&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">5&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">5&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%21&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%18&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%22&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%21&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%23&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%20&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">5&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">5&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%24&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%23&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">5&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%25&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%22&lt;/span>, &lt;span style="color:#000">%24&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%26&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%arg4&lt;/span>, &lt;span style="color:#000">%c16_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%27&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%26&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%28&lt;/span>&lt;span style="color:#f00">:&lt;/span>&lt;span style="color:#3af">3&lt;/span> = &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#00f">or&lt;/span> &lt;span style="color:#000">%arg6&lt;/span> = &lt;span style="color:#000">%c0&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">step&lt;/span> &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">iter_args&lt;/span>(&lt;span style="color:#000">%arg7&lt;/span> = &lt;span style="color:#000">%cst&lt;/span>, &lt;span style="color:#000">%arg8&lt;/span> = &lt;span style="color:#000">%14&lt;/span>, &lt;span style="color:#000">%arg9&lt;/span> = &lt;span style="color:#000">%25&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%36&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg8&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%37&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg9&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%38&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%36&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%39&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%37&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%40&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%38&lt;/span>, &lt;span style="color:#000">%39&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>}&amp;gt;&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>}&amp;gt;&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%41&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg8&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%42&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg9&lt;/span>, &lt;span style="color:#000">%27&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">yield&lt;/span> &lt;span style="color:#000">%40&lt;/span>, &lt;span style="color:#000">%41&lt;/span>, &lt;span style="color:#000">%42&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%29&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg5&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%30&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%3&lt;/span>, &lt;span style="color:#000">%29&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%31&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg2&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%32&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%31&lt;/span>, &lt;span style="color:#000">%30&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%33&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%32&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%34&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%33&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">2&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%35&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%34&lt;/span>, &lt;span style="color:#000">%24&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">store&lt;/span> &lt;span style="color:#000">%35&lt;/span>, &lt;span style="color:#000">%28&lt;/span>&lt;span style="color:#000">#0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">4&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这里比较明显的是&lt;/p>
&lt;ol>
&lt;li>作为 dotOp 的输出， &lt;code>%40&lt;/code> 应该是 mma layout，但这一步还是 blocked layout，这个会在下一节里面改写&lt;/li>
&lt;li>&lt;code>%38&lt;/code>, &lt;code>%39&lt;/code> 这些的 layout 应该是 &lt;code>dot_op&amp;lt;mma&amp;gt;&lt;/code> 但由于 mma layout 还没有给定，所以还是 &lt;code>dot_op&amp;lt;blocked&amp;gt;&lt;/code>&lt;/li>
&lt;/ol>
&lt;h4 id="ir-after-tritongpucombineops">IR After TritonGPUCombineOps&lt;/h4>
&lt;p>这一步会包含很多 Op pattern 的改写，直接的变化是&lt;/p>
&lt;ul>
&lt;li>给 dot 相关的增加了 mma 的 data layout&lt;/li>
&lt;li>插入了 mma layout 相关的 &lt;code>convert_layout&lt;/code>&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">2&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">4&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span>&lt;span style="color:#f00">#mma&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">mma&lt;/span>&amp;lt;{&lt;span style="color:#f00">version&lt;/span> = &lt;span style="color:#3af">2&lt;/span>, &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">module&lt;/span> &lt;span style="color:#00f">attributes&lt;/span> {&lt;span style="color:#5a2">&amp;#34;triton_gpu.num-warps&amp;#34;&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c56c78c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c64&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c16_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">0.000000e+00&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%cst_0&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#f00">dense&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&amp;gt; &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%0&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%1&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%2&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%3&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg3&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%4&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%5&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%6&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%0&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%7&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%6&lt;/span>, &lt;span style="color:#000">%3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%8&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%4&lt;/span>, &lt;span style="color:#000">%7&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%9&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%8&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%10&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%5&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%11&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%10&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%12&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg4&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%13&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg1&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%14&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">8&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%15&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">make_range&lt;/span> {&lt;span style="color:#00f">end&lt;/span> = &lt;span style="color:#3af">8&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">start&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%16&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%1&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%17&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%16&lt;/span>, &lt;span style="color:#000">%12&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%18&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%13&lt;/span>, &lt;span style="color:#000">%17&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%19&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%18&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%20&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%14&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%21&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%20&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%22&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%15&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%23&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%22&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%24&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%arg4&lt;/span>, &lt;span style="color:#000">%c16_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%25&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%24&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%26&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%9&lt;/span>, &lt;span style="color:#000">%11&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%27&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%19&lt;/span>, &lt;span style="color:#000">%21&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%28&lt;/span>&lt;span style="color:#f00">:&lt;/span>&lt;span style="color:#3af">3&lt;/span> = &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#00f">or&lt;/span> &lt;span style="color:#000">%arg6&lt;/span> = &lt;span style="color:#000">%c0&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">step&lt;/span> &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">iter_args&lt;/span>(&lt;span style="color:#000">%arg7&lt;/span> = &lt;span style="color:#000">%cst&lt;/span>, &lt;span style="color:#000">%arg8&lt;/span> = &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%arg9&lt;/span> = &lt;span style="color:#000">%27&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%37&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg8&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%38&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">load&lt;/span> &lt;span style="color:#000">%arg9&lt;/span> {&lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%39&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%37&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%40&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%38&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%41&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%39&lt;/span>, &lt;span style="color:#000">%40&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%42&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg8&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%43&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg9&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">yield&lt;/span> &lt;span style="color:#000">%41&lt;/span>, &lt;span style="color:#000">%42&lt;/span>, &lt;span style="color:#000">%43&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%29&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg5&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%30&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%arg2&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%31&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">expand_dims&lt;/span> &lt;span style="color:#000">%2&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">slice&lt;/span>&amp;lt;{&lt;span style="color:#f00">dim&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>}&amp;gt;&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">muli&lt;/span> &lt;span style="color:#000">%31&lt;/span>, &lt;span style="color:#000">%29&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%33&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%30&lt;/span>, &lt;span style="color:#000">%32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%34&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">broadcast&lt;/span> &lt;span style="color:#000">%33&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">1&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%35&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%34&lt;/span>, &lt;span style="color:#000">%23&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%36&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%28&lt;/span>&lt;span style="color:#000">#0&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#00f">store&lt;/span> &lt;span style="color:#000">%35&lt;/span>, &lt;span style="color:#000">%36&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ir-after-tritongpupipeline">IR After TritonGPUPipeline&lt;/h4>
&lt;p>这一步可以认为是在 global memory -&amp;gt; shared memory 的数据搬运做 Pipeline 优化。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">2&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">4&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#mma&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">mma&lt;/span>&amp;lt;{&lt;span style="color:#f00">version&lt;/span> = &lt;span style="color:#3af">2&lt;/span>, &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">shared&lt;/span>&amp;lt;{&lt;span style="color:#f00">ve&lt;/span>&lt;span style="color:#00f">c&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">perPhase&lt;/span> = &lt;span style="color:#3af">4&lt;/span>, &lt;span style="color:#f00">maxPhase&lt;/span> = &lt;span style="color:#3af">2&lt;/span>, &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">shared&lt;/span>&amp;lt;{&lt;span style="color:#f00">ve&lt;/span>&lt;span style="color:#00f">c&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">perPhase&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">maxPhase&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">module&lt;/span> &lt;span style="color:#00f">attributes&lt;/span> {&lt;span style="color:#5a2">&amp;#34;triton_gpu.num-warps&amp;#34;&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c56c78c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%28&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">cmpi&lt;/span> &lt;span style="color:#00f">slt&lt;/span>, &lt;span style="color:#000">%c0&lt;/span>, &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%29&lt;/span> = &lt;span style="color:#000">triton_gpu.alloc_tensor :&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%30&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%28&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%31&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%29&lt;/span>, &lt;span style="color:#000">%c0_i32&lt;/span>, &lt;span style="color:#000">%30&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%32&lt;/span> = &lt;span style="color:#000">triton_gpu.alloc_tensor :&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%33&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%28&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%34&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%32&lt;/span>, &lt;span style="color:#000">%c0_i32&lt;/span>, &lt;span style="color:#000">%33&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%35&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%36&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%40&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%39&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%41&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%35&lt;/span>, &lt;span style="color:#000">%31&lt;/span>, &lt;span style="color:#000">%37&lt;/span>, &lt;span style="color:#000">%40&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%42&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%39&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%43&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%36&lt;/span>, &lt;span style="color:#000">%34&lt;/span>, &lt;span style="color:#000">%37&lt;/span>, &lt;span style="color:#000">%42&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%44&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%35&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%45&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%36&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_1&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%46&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%37&lt;/span>, &lt;span style="color:#000">%c1_i32_1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">async_wait&lt;/span> {&lt;span style="color:#f00">num&lt;/span> = &lt;span style="color:#3af">2&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c0_i32_2&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%47&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%41&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">16&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%48&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%43&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">8&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_3&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%49&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%c0_i32_2&lt;/span>, &lt;span style="color:#000">%c1_i32_3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%50&lt;/span>&lt;span style="color:#f00">:&lt;/span>&lt;span style="color:#3af">12&lt;/span> = &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#00f">or&lt;/span> &lt;span style="color:#000">%arg6&lt;/span> = &lt;span style="color:#000">%c0&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">step&lt;/span> &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">iter_args&lt;/span>(&lt;span style="color:#000">%arg7&lt;/span> = &lt;span style="color:#000">%cst&lt;/span>, &lt;span style="color:#000">%arg8&lt;/span> = &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%arg9&lt;/span> = &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%arg10&lt;/span> = &lt;span style="color:#000">%41&lt;/span>, &lt;span style="color:#000">%arg11&lt;/span> = &lt;span style="color:#000">%43&lt;/span>, &lt;span style="color:#000">%arg12&lt;/span> = &lt;span style="color:#000">%47&lt;/span>, &lt;span style="color:#000">%arg13&lt;/span> = &lt;span style="color:#000">%48&lt;/span>, &lt;span style="color:#000">%arg14&lt;/span> = &lt;span style="color:#000">%45&lt;/span>, &lt;span style="color:#000">%arg15&lt;/span> = &lt;span style="color:#000">%44&lt;/span>, &lt;span style="color:#000">%arg16&lt;/span> = &lt;span style="color:#000">%38&lt;/span>, &lt;span style="color:#000">%arg17&lt;/span> = &lt;span style="color:#000">%46&lt;/span>, &lt;span style="color:#000">%arg18&lt;/span> = &lt;span style="color:#000">%49&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%59&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%arg12&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%60&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%arg13&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%61&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%59&lt;/span>, &lt;span style="color:#000">%60&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%62&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg8&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%63&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg9&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%64&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg16&lt;/span>, &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%65&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">cmpi&lt;/span> &lt;span style="color:#00f">slt&lt;/span>, &lt;span style="color:#000">%64&lt;/span>, &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c3_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%66&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">remsi&lt;/span> &lt;span style="color:#000">%arg17&lt;/span>, &lt;span style="color:#000">%c3_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c3_i32_4&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%67&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">remsi&lt;/span> &lt;span style="color:#000">%arg18&lt;/span>, &lt;span style="color:#000">%c3_i32_4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%68&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">index_cast&lt;/span> &lt;span style="color:#000">%67&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%69&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%65&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%70&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%arg15&lt;/span>, &lt;span style="color:#000">%arg10&lt;/span>, &lt;span style="color:#000">%66&lt;/span>, &lt;span style="color:#000">%69&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%71&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%65&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%72&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%arg14&lt;/span>, &lt;span style="color:#000">%arg11&lt;/span>, &lt;span style="color:#000">%66&lt;/span>, &lt;span style="color:#000">%71&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%73&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg15&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%74&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg14&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">async_wait&lt;/span> {&lt;span style="color:#f00">num&lt;/span> = &lt;span style="color:#3af">2&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%75&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%70&lt;/span>[&lt;span style="color:#000">%68&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">16&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%76&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%72&lt;/span>[&lt;span style="color:#000">%68&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">8&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_5&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%77&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg17&lt;/span>, &lt;span style="color:#000">%c1_i32_5&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_6&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%78&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg18&lt;/span>, &lt;span style="color:#000">%c1_i32_6&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">yield&lt;/span> &lt;span style="color:#000">%61&lt;/span>, &lt;span style="color:#000">%62&lt;/span>, &lt;span style="color:#000">%63&lt;/span>, &lt;span style="color:#000">%70&lt;/span>, &lt;span style="color:#000">%72&lt;/span>, &lt;span style="color:#000">%75&lt;/span>, &lt;span style="color:#000">%76&lt;/span>, &lt;span style="color:#000">%74&lt;/span>, &lt;span style="color:#000">%73&lt;/span>, &lt;span style="color:#000">%64&lt;/span>, &lt;span style="color:#000">%77&lt;/span>, &lt;span style="color:#000">%78&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ir-before-tritongpuprefetch">IR Before TritonGPUPrefetch&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">2&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">4&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#mma&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">mma&lt;/span>&amp;lt;{&lt;span style="color:#f00">version&lt;/span> = &lt;span style="color:#3af">2&lt;/span>, &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">shared&lt;/span>&amp;lt;{&lt;span style="color:#f00">ve&lt;/span>&lt;span style="color:#00f">c&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">perPhase&lt;/span> = &lt;span style="color:#3af">4&lt;/span>, &lt;span style="color:#f00">maxPhase&lt;/span> = &lt;span style="color:#3af">2&lt;/span>, &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">shared&lt;/span>&amp;lt;{&lt;span style="color:#f00">ve&lt;/span>&lt;span style="color:#00f">c&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">perPhase&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">maxPhase&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">module&lt;/span> &lt;span style="color:#00f">attributes&lt;/span> {&lt;span style="color:#5a2">&amp;#34;triton_gpu.num-warps&amp;#34;&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c56c78c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt;, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%28&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">cmpi&lt;/span> &lt;span style="color:#00f">slt&lt;/span>, &lt;span style="color:#000">%c0&lt;/span>, &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%29&lt;/span> = &lt;span style="color:#000">triton_gpu.alloc_tensor :&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%30&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%28&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%31&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%29&lt;/span>, &lt;span style="color:#000">%c0_i32&lt;/span>, &lt;span style="color:#000">%30&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%32&lt;/span> = &lt;span style="color:#000">triton_gpu.alloc_tensor :&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%33&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%28&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%34&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%32&lt;/span>, &lt;span style="color:#000">%c0_i32&lt;/span>, &lt;span style="color:#000">%33&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%35&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%36&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%40&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%39&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%41&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%35&lt;/span>, &lt;span style="color:#000">%31&lt;/span>, &lt;span style="color:#000">%37&lt;/span>, &lt;span style="color:#000">%40&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%42&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%39&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%43&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%36&lt;/span>, &lt;span style="color:#000">%34&lt;/span>, &lt;span style="color:#000">%37&lt;/span>, &lt;span style="color:#000">%42&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%44&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%35&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%45&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%36&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_1&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%46&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%37&lt;/span>, &lt;span style="color:#000">%c1_i32_1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">async_wait&lt;/span> {&lt;span style="color:#f00">num&lt;/span> = &lt;span style="color:#3af">2&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c0_i32_2&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%47&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%41&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">16&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%48&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%43&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">8&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_3&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%49&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%c0_i32_2&lt;/span>, &lt;span style="color:#000">%c1_i32_3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%50&lt;/span>&lt;span style="color:#f00">:&lt;/span>&lt;span style="color:#3af">12&lt;/span> = &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#00f">or&lt;/span> &lt;span style="color:#000">%arg6&lt;/span> = &lt;span style="color:#000">%c0&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">step&lt;/span> &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">iter_args&lt;/span>(&lt;span style="color:#000">%arg7&lt;/span> = &lt;span style="color:#000">%cst&lt;/span>, &lt;span style="color:#000">%arg8&lt;/span> = &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%arg9&lt;/span> = &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%arg10&lt;/span> = &lt;span style="color:#000">%41&lt;/span>, &lt;span style="color:#000">%arg11&lt;/span> = &lt;span style="color:#000">%43&lt;/span>, &lt;span style="color:#000">%arg12&lt;/span> = &lt;span style="color:#000">%47&lt;/span>, &lt;span style="color:#000">%arg13&lt;/span> = &lt;span style="color:#000">%48&lt;/span>, &lt;span style="color:#000">%arg14&lt;/span> = &lt;span style="color:#000">%45&lt;/span>, &lt;span style="color:#000">%arg15&lt;/span> = &lt;span style="color:#000">%44&lt;/span>, &lt;span style="color:#000">%arg16&lt;/span> = &lt;span style="color:#000">%38&lt;/span>, &lt;span style="color:#000">%arg17&lt;/span> = &lt;span style="color:#000">%46&lt;/span>, &lt;span style="color:#000">%arg18&lt;/span> = &lt;span style="color:#000">%49&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%59&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%arg12&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%60&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%arg13&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%61&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%59&lt;/span>, &lt;span style="color:#000">%60&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%62&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg8&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%63&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg9&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%64&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg16&lt;/span>, &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%65&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">cmpi&lt;/span> &lt;span style="color:#00f">slt&lt;/span>, &lt;span style="color:#000">%64&lt;/span>, &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c3_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%66&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">remsi&lt;/span> &lt;span style="color:#000">%arg17&lt;/span>, &lt;span style="color:#000">%c3_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c3_i32_4&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%67&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">remsi&lt;/span> &lt;span style="color:#000">%arg18&lt;/span>, &lt;span style="color:#000">%c3_i32_4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%68&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">index_cast&lt;/span> &lt;span style="color:#000">%67&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%69&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%65&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%70&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%arg15&lt;/span>, &lt;span style="color:#000">%arg10&lt;/span>, &lt;span style="color:#000">%66&lt;/span>, &lt;span style="color:#000">%69&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%71&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%65&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%72&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%arg14&lt;/span>, &lt;span style="color:#000">%arg11&lt;/span>, &lt;span style="color:#000">%66&lt;/span>, &lt;span style="color:#000">%71&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%73&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg15&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%74&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg14&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">async_wait&lt;/span> {&lt;span style="color:#f00">num&lt;/span> = &lt;span style="color:#3af">2&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%75&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%70&lt;/span>[&lt;span style="color:#000">%68&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">16&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%76&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%72&lt;/span>[&lt;span style="color:#000">%68&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">8&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_5&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%77&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg17&lt;/span>, &lt;span style="color:#000">%c1_i32_5&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_6&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%78&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg18&lt;/span>, &lt;span style="color:#000">%c1_i32_6&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">yield&lt;/span> &lt;span style="color:#000">%61&lt;/span>, &lt;span style="color:#000">%62&lt;/span>, &lt;span style="color:#000">%63&lt;/span>, &lt;span style="color:#000">%70&lt;/span>, &lt;span style="color:#000">%72&lt;/span>, &lt;span style="color:#000">%75&lt;/span>, &lt;span style="color:#000">%76&lt;/span>, &lt;span style="color:#000">%74&lt;/span>, &lt;span style="color:#000">%73&lt;/span>, &lt;span style="color:#000">%64&lt;/span>, &lt;span style="color:#000">%77&lt;/span>, &lt;span style="color:#000">%78&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ir-after-tritongpuprefetch">IR After TritonGPUPrefetch&lt;/h4>
&lt;p>这一步可以认为是在 Dot 相关的 shared memory -&amp;gt; registers 的数据搬运阶段做 Pipepline 优化。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">2&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">blocked&lt;/span>&amp;lt;{&lt;span style="color:#f00">sizePerThread&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">threadsPerWarp&lt;/span> = [&lt;span style="color:#3af">4&lt;/span>, &lt;span style="color:#3af">8&lt;/span>], &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>], &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#mma&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">mma&lt;/span>&amp;lt;{&lt;span style="color:#f00">version&lt;/span> = &lt;span style="color:#3af">2&lt;/span>, &lt;span style="color:#f00">warpsPerCTA&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">shared&lt;/span>&amp;lt;{&lt;span style="color:#f00">ve&lt;/span>&lt;span style="color:#00f">c&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">perPhase&lt;/span> = &lt;span style="color:#3af">4&lt;/span>, &lt;span style="color:#f00">maxPhase&lt;/span> = &lt;span style="color:#3af">2&lt;/span>, &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span> = &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">shared&lt;/span>&amp;lt;{&lt;span style="color:#f00">ve&lt;/span>&lt;span style="color:#00f">c&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">perPhase&lt;/span> = &lt;span style="color:#3af">8&lt;/span>, &lt;span style="color:#f00">maxPhase&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">order&lt;/span> = [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">0&lt;/span>]}&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">module&lt;/span> &lt;span style="color:#00f">attributes&lt;/span> {&lt;span style="color:#5a2">&amp;#34;triton_gpu.num-warps&amp;#34;&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#f00">publi&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c56c78c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">async_wait&lt;/span> {&lt;span style="color:#f00">num&lt;/span> = &lt;span style="color:#3af">2&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c0_i32_2&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%47&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%41&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">16&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%48&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%43&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">8&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_3&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%49&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%c0_i32_2&lt;/span>, &lt;span style="color:#000">%c1_i32_3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%50&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%47&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">16&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%51&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%50&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%52&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%48&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">8&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%53&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%52&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%54&lt;/span>&lt;span style="color:#f00">:&lt;/span>&lt;span style="color:#3af">14&lt;/span> = &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#00f">or&lt;/span> &lt;span style="color:#000">%arg6&lt;/span> = &lt;span style="color:#000">%c0&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">step&lt;/span> &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">iter_args&lt;/span>(&lt;span style="color:#000">%arg7&lt;/span> = &lt;span style="color:#000">%cst&lt;/span>, &lt;span style="color:#000">%arg8&lt;/span> = &lt;span style="color:#000">%26&lt;/span>, &lt;span style="color:#000">%arg9&lt;/span> = &lt;span style="color:#000">%27&lt;/span>, &lt;span style="color:#000">%arg10&lt;/span> = &lt;span style="color:#000">%41&lt;/span>, &lt;span style="color:#000">%arg11&lt;/span> = &lt;span style="color:#000">%43&lt;/span>, &lt;span style="color:#000">%arg12&lt;/span> = &lt;span style="color:#000">%47&lt;/span>, &lt;span style="color:#000">%arg13&lt;/span> = &lt;span style="color:#000">%48&lt;/span>, &lt;span style="color:#000">%arg14&lt;/span> = &lt;span style="color:#000">%45&lt;/span>, &lt;span style="color:#000">%arg15&lt;/span> = &lt;span style="color:#000">%44&lt;/span>, &lt;span style="color:#000">%arg16&lt;/span> = &lt;span style="color:#000">%38&lt;/span>, &lt;span style="color:#000">%arg17&lt;/span> = &lt;span style="color:#000">%46&lt;/span>, &lt;span style="color:#000">%arg18&lt;/span> = &lt;span style="color:#000">%49&lt;/span>, &lt;span style="color:#000">%arg19&lt;/span> = &lt;span style="color:#000">%51&lt;/span>, &lt;span style="color:#000">%arg20&lt;/span> = &lt;span style="color:#000">%53&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;) {
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%63&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%arg12&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%64&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%arg13&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%65&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%63&lt;/span>, &lt;span style="color:#000">%64&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%66&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">dot&lt;/span> &lt;span style="color:#000">%arg19&lt;/span>, &lt;span style="color:#000">%arg20&lt;/span>, &lt;span style="color:#000">%arg7&lt;/span> {&lt;span style="color:#f00">allowTF&lt;/span>&lt;span style="color:#3af">32&lt;/span> = &lt;span style="color:#00f">true&lt;/span>, &lt;span style="color:#f00">transA&lt;/span> = &lt;span style="color:#00f">false&lt;/span>, &lt;span style="color:#f00">transB&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; * &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%67&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg8&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%68&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg9&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%69&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg16&lt;/span>, &lt;span style="color:#000">%c16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%70&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">cmpi&lt;/span> &lt;span style="color:#00f">slt&lt;/span>, &lt;span style="color:#000">%69&lt;/span>, &lt;span style="color:#000">%c64&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c3_i32&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%71&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">remsi&lt;/span> &lt;span style="color:#000">%arg17&lt;/span>, &lt;span style="color:#000">%c3_i32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c3_i32_4&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%72&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">remsi&lt;/span> &lt;span style="color:#000">%arg18&lt;/span>, &lt;span style="color:#000">%c3_i32_4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%73&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">index_cast&lt;/span> &lt;span style="color:#000">%72&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%74&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%70&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%75&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%arg15&lt;/span>, &lt;span style="color:#000">%arg10&lt;/span>, &lt;span style="color:#000">%71&lt;/span>, &lt;span style="color:#000">%74&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%76&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">splat&lt;/span> &lt;span style="color:#000">%70&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%77&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">insert_slice_asyn&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">%arg14&lt;/span>, &lt;span style="color:#000">%arg11&lt;/span>, &lt;span style="color:#000">%71&lt;/span>, &lt;span style="color:#000">%76&lt;/span> {&lt;span style="color:#f00">axis&lt;/span> = &lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">cache&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">evict&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">isVolatile&lt;/span> = &lt;span style="color:#00f">false&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%78&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg15&lt;/span>, &lt;span style="color:#000">%cst_0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%79&lt;/span> = &lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">addptr&lt;/span> &lt;span style="color:#000">%arg14&lt;/span>, &lt;span style="color:#000">%25&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">async_wait&lt;/span> {&lt;span style="color:#f00">num&lt;/span> = &lt;span style="color:#3af">2&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%80&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%75&lt;/span>[&lt;span style="color:#000">%73&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">16&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%81&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%77&lt;/span>[&lt;span style="color:#000">%73&lt;/span>, &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">8&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_5&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%82&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg17&lt;/span>, &lt;span style="color:#000">%c1_i32_5&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%c1_i32_6&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#00f">constant&lt;/span> &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%83&lt;/span> = &lt;span style="color:#f00">arith&lt;/span>.&lt;span style="color:#f00">addi&lt;/span> &lt;span style="color:#000">%arg18&lt;/span>, &lt;span style="color:#000">%c1_i32_6&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%84&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%80&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">16&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%85&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%84&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%86&lt;/span> = &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>.&lt;span style="color:#f00">extract_slice&lt;/span> &lt;span style="color:#000">%81&lt;/span>[&lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#3af">0&lt;/span>] [&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">8&lt;/span>] [&lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#3af">1&lt;/span>] &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%87&lt;/span> = &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">convert_layout&lt;/span> &lt;span style="color:#000">%86&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">scf&lt;/span>.&lt;span style="color:#f00">yield&lt;/span> &lt;span style="color:#000">%65&lt;/span>, &lt;span style="color:#000">%67&lt;/span>, &lt;span style="color:#000">%68&lt;/span>, &lt;span style="color:#000">%75&lt;/span>, &lt;span style="color:#000">%77&lt;/span>, &lt;span style="color:#000">%80&lt;/span>, &lt;span style="color:#000">%81&lt;/span>, &lt;span style="color:#000">%79&lt;/span>, &lt;span style="color:#000">%78&lt;/span>, &lt;span style="color:#000">%69&lt;/span>, &lt;span style="color:#000">%82&lt;/span>, &lt;span style="color:#000">%83&lt;/span>, &lt;span style="color:#000">%85&lt;/span>, &lt;span style="color:#000">%87&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">#mma&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">3&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#shared&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#00f">x&lt;/span>&lt;span style="color:#000">!tt.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">#blocked&lt;/span>&lt;span style="color:#3af">0&lt;/span>&amp;gt;, &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">0&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;, &lt;span style="color:#f00">tens&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">16&lt;/span>&lt;span style="color:#f00">x&lt;/span>&lt;span style="color:#3af">8&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#f00">#triton_gpu&lt;/span>.&lt;span style="color:#f00">dot_op&lt;/span>&amp;lt;{&lt;span style="color:#f00">opId&lt;/span>&lt;span style="color:#00f">x&lt;/span> = &lt;span style="color:#3af">1&lt;/span>, &lt;span style="color:#f00">parent&lt;/span> = &lt;span style="color:#f00">#mma&lt;/span>}&amp;gt;&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">return&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="ir-after-tritongputollvm">IR After TritonGPUToLLVM&lt;/h4>
&lt;p>MLIR 阶段的最后一步就是 translate 到 LLVM dialect，可以看到其中 Triton backend 插入的 Inline Asm。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">&lt;code class="language-llvm" data-lang="llvm">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#00f">module&lt;/span> &lt;span style="color:#00f">attributes&lt;/span> {&lt;span style="color:#5a2">&amp;#34;triton_gpu.num-warps&amp;#34;&lt;/span> = &lt;span style="color:#3af">4&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">triton_gpu&lt;/span>.&lt;span style="color:#f00">shared&lt;/span> = &lt;span style="color:#3af">36864&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">global&lt;/span> &lt;span style="color:#00f">external&lt;/span> &lt;span style="color:#000">@global_smem&lt;/span>() {&lt;span style="color:#f00">addr_space&lt;/span> = &lt;span style="color:#3af">3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>} &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!llvm.array&lt;/span>&amp;lt;&lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#00f">x&lt;/span> &lt;span style="color:#00f">i8&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">fun&lt;/span>&lt;span style="color:#00f">c&lt;/span> &lt;span style="color:#000">@matmul_kernel_0d1d2d3d4c5d6c7d8c&lt;/span>(&lt;span style="color:#000">%arg0&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!llvm.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">1&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg1&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!llvm.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">1&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg2&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!llvm.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#3af">1&lt;/span>&amp;gt; {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg3&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg4&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}, &lt;span style="color:#000">%arg5&lt;/span>&lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span> {&lt;span style="color:#f00">tt&lt;/span>.&lt;span style="color:#f00">divisibility&lt;/span> = &lt;span style="color:#3af">16&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>}) &lt;span style="color:#00f">attributes&lt;/span> {&lt;span style="color:#f00">nvvm&lt;/span>.&lt;span style="color:#f00">kernel&lt;/span> = &lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">u&lt;/span>&lt;span style="color:#00f">i1&lt;/span>, &lt;span style="color:#f00">nvvm&lt;/span>.&lt;span style="color:#f00">maxntid&lt;/span> = &lt;span style="color:#3af">128&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#f00">sym_visibility&lt;/span> = &lt;span style="color:#5a2">&amp;#34;public&amp;#34;&lt;/span>} {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%0&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#f00">addressof&lt;/span> &lt;span style="color:#000">@global_smem&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!llvm.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">array&lt;/span>&amp;lt;&lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#00f">x&lt;/span> &lt;span style="color:#00f">i8&lt;/span>&amp;gt;, &lt;span style="color:#3af">3&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%1&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#00f">bitcast&lt;/span> &lt;span style="color:#000">%0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#000">!llvm.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">array&lt;/span>&amp;lt;&lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#00f">x&lt;/span> &lt;span style="color:#00f">i8&lt;/span>&amp;gt;, &lt;span style="color:#3af">3&lt;/span>&amp;gt; &lt;span style="color:#00f">to&lt;/span> &lt;span style="color:#000">!llvm.ptr&lt;/span>&amp;lt;&lt;span style="color:#00f">i8&lt;/span>, &lt;span style="color:#3af">3&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%2&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">constant&lt;/span>(&lt;span style="color:#3af">3&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%3&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">constant&lt;/span>(&lt;span style="color:#3af">1&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%4&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">constant&lt;/span>(&lt;span style="color:#3af">0&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%5&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">constant&lt;/span>(&lt;span style="color:#3af">2&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%6&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">constant&lt;/span>(&lt;span style="color:#00f">true&lt;/span>) &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%7&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">constant&lt;/span>(&lt;span style="color:#3af">32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">inde&lt;/span>&lt;span style="color:#00f">x&lt;/span>) &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%8&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">constant&lt;/span>(&lt;span style="color:#3af">32&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>) &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#00f">i32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">%9&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">mlir&lt;/span>.&lt;span style="color:#00f">constant&lt;/span>(&lt;span style="color:#3af">0.000000e+00&lt;/span> &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>) &lt;span style="color:#f00">:&lt;/span> &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%567&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">inline_&lt;/span>&lt;span style="color:#00f">asm&lt;/span> &lt;span style="color:#f00">has_side_effects&lt;/span> &lt;span style="color:#f00">asm_dialect&lt;/span> = &lt;span style="color:#f00">att&lt;/span> &lt;span style="color:#f00">operand_attrs&lt;/span> = [] &lt;span style="color:#5a2">&amp;#34;ldmatrix.sync.aligned.m8n8.x4.shared.b16 { $0, $1, $2, $3 }, [ $4 + 0 ];&amp;#34;&lt;/span>, &lt;span style="color:#5a2">&amp;#34;=r,=r,=r,=r,r&amp;#34;&lt;/span> &lt;span style="color:#000">%566&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#000">!llvm.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">16&lt;/span>, &lt;span style="color:#3af">3&lt;/span>&amp;gt;) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#000">!llvm.struct&lt;/span>&amp;lt;(&lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;)&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%765&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">inline_&lt;/span>&lt;span style="color:#00f">asm&lt;/span> &lt;span style="color:#f00">has_side_effects&lt;/span> &lt;span style="color:#f00">asm_dialect&lt;/span> = &lt;span style="color:#f00">att&lt;/span> &lt;span style="color:#f00">operand_attrs&lt;/span> = [] &lt;span style="color:#5a2">&amp;#34;mma.sync.aligned.m16n8k16.row.col.f32.f16.f16.f32 { $0, $1, $2, $3 }, { $4, $5, $6, $7 }, { $8, $9 }, { $10, $11, $12, $13 };&amp;#34;&lt;/span>, &lt;span style="color:#5a2">&amp;#34;=r,=r,=r,=r,r,r,r,r,r,r,0,1,2,3&amp;#34;&lt;/span> &lt;span style="color:#000">%677&lt;/span>, &lt;span style="color:#000">%679&lt;/span>, &lt;span style="color:#000">%678&lt;/span>, &lt;span style="color:#000">%680&lt;/span>, &lt;span style="color:#000">%685&lt;/span>, &lt;span style="color:#000">%686&lt;/span>, &lt;span style="color:#000">%701&lt;/span>, &lt;span style="color:#000">%702&lt;/span>, &lt;span style="color:#000">%703&lt;/span>, &lt;span style="color:#000">%704&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">vect&lt;/span>&lt;span style="color:#00f">or&lt;/span>&amp;lt;&lt;span style="color:#3af">2&lt;/span>&lt;span style="color:#f00">xf&lt;/span>&lt;span style="color:#3af">16&lt;/span>&amp;gt;, &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#000">!llvm.struct&lt;/span>&amp;lt;(&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>)&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;span style="display:flex; background-color:#e5e5e5">&lt;span> &lt;span style="color:#000">%1789&lt;/span> = &lt;span style="color:#f00">llvm&lt;/span>.&lt;span style="color:#f00">inline_&lt;/span>&lt;span style="color:#00f">asm&lt;/span> &lt;span style="color:#f00">has_side_effects&lt;/span> &lt;span style="color:#f00">asm_dialect&lt;/span> = &lt;span style="color:#f00">att&lt;/span> &lt;span style="color:#f00">operand_attrs&lt;/span> = [] &lt;span style="color:#5a2">&amp;#34;@$5 st.global.v4.b32 [ $4 + 0 ], { $0, $1, $2, $3 };&amp;#34;&lt;/span>, &lt;span style="color:#5a2">&amp;#34;r,r,r,r,l,b&amp;#34;&lt;/span> &lt;span style="color:#000">%1782&lt;/span>, &lt;span style="color:#000">%1784&lt;/span>, &lt;span style="color:#000">%1786&lt;/span>, &lt;span style="color:#000">%1788&lt;/span>, &lt;span style="color:#000">%1449&lt;/span>, &lt;span style="color:#000">%6&lt;/span> &lt;span style="color:#f00">:&lt;/span> (&lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#00f">i32&lt;/span>, &lt;span style="color:#000">!llvm.ptr&lt;/span>&amp;lt;&lt;span style="color:#f00">f&lt;/span>&lt;span style="color:#3af">32&lt;/span>, &lt;span style="color:#3af">1&lt;/span>&amp;gt;, &lt;span style="color:#00f">i1&lt;/span>) &lt;span style="color:#f00">-&lt;/span>&amp;gt; &lt;span style="color:#000">!llvm.void&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>About me</title><link>/posts/about/</link><pubDate>Sat, 15 Oct 2022 00:00:00 +0000</pubDate><guid>/posts/about/</guid><description>&lt;h2 id="about-me">About me&lt;/h2>
&lt;p>Thank you for your interest.&lt;/p>
&lt;p>I am a Deep Learning system architect at NVIDIA, and my current focus is high-performance AI Compiler(on GPU).&lt;/p>
&lt;p>Before this, I was a senior engineer in Baidu, working as an architect on PaddlePaddle (one of the most popular open-sourced deep learning frameworks in China market).&lt;/p>
&lt;p>I was the creator &amp;amp; primary author &amp;amp; tech lead of the following projects in PaddlePaddle ecosystem (before 2022-6)&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/PaddlePaddle/Paddle/tree/v2.3.2/paddle/fluid/inference">Paddle-Inference&lt;/a> - the server-class DL inference engine,&lt;/li>
&lt;li>&lt;a href="https://github.com/PaddlePaddle/Paddle-Lite/tree/v2.11">Paddle-Lite&lt;/a> - A on-device inference engine with high-performance, tiny deployment size,&lt;/li>
&lt;li>&lt;a href="https://github.com/PaddlePaddle/CINN">Paddle-CINN&lt;/a> - A DL compiler for automatically generating high-performance kernels &amp;amp; programs for AI models,&lt;/li>
&lt;li>&lt;a href="https://github.com/PaddlePaddle/Paddle/tree/v2.3.2/paddle/infrt">Paddle/infrt&lt;/a> - A unified architecture for both server-class and mobile devices, powered by MLIR, highly modular design,&lt;/li>
&lt;li>&lt;a href="https://github.com/PaddlePaddle/VisualDL">Paddle-VisualDL&lt;/a> - A visualization tool for AI model,&lt;/li>
&lt;li>&lt;a href="https://github.com/PaddlePaddle/continuous_evaluation">Paddle/continuous_evaluation&lt;/a> - A system that continuously traces the indicators modeling the performance of AI models.&lt;/li>
&lt;/ul></description></item><item><title>Emacs essentials</title><link>/posts/emacs-essentials/</link><pubDate>Sat, 15 Oct 2022 00:00:00 +0000</pubDate><guid>/posts/emacs-essentials/</guid><description>&lt;p>It is a steep learning curve to master Emacs lisp, there are mainly two issues in it from my experience&lt;/p>
&lt;ol>
&lt;li>the lisp syntax and functional programming&lt;/li>
&lt;li>the fragmented methods and libraries&lt;/li>
&lt;/ol>
&lt;p>For the 1st issue, it is easy to master the syntax after writing several programs and getting used to them, but for the 2nd one, one needs to take notes or remember something.&lt;/p>
&lt;p>In this blog, I focus on the 2nd point and keep updating the notes of some methods and libraries that I think are essential for writing Emacs lisp packages.&lt;/p>
&lt;h2 id="builtin-methods">builtin methods&lt;/h2>
&lt;h3 id="buffer">buffer&lt;/h3>
&lt;h4 id="current-buffer-get-the-current-buffer">current-buffer: get the current buffer&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">current-buffer&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="get-buffer-get-a-buffer-by-name">get-buffer: get a buffer by name&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">get-buffer&lt;/span> &lt;span style="color:#5a2">&amp;#34;*scratch*&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="get-buffer-create-create-the-buffer-if-not-exist">get-buffer-create: create the buffer if not exist&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">get-buffer-create&lt;/span> &lt;span style="color:#5a2">&amp;#34;yaya&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="changing-the-current-buffer">changing the current buffer&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">progn&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">set-buffer&lt;/span> (&lt;span style="color:#000">get-buffer&lt;/span> &lt;span style="color:#5a2">&amp;#34;*scratch*&amp;#34;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">current-buffer&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="changing-the-current-buffer-safely">Changing the current buffer safely&lt;/h4>
&lt;p>It will return to the original buffer after the operation finished.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">progn&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">save-current-buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">set-buffer&lt;/span> &lt;span style="color:#5a2">&amp;#34;*scratch*&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">message&lt;/span> &lt;span style="color:#5a2">&amp;#34;Current buffer: %s&amp;#34;&lt;/span> (&lt;span style="color:#000">current-buffer&lt;/span>)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">current-buffer&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="working-with-file-buffers">Working with file buffers&lt;/h4>
&lt;p>To get the full file path for the file that the buffer represents&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">buffer-file-name&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>To find a buffer that represents a particular file&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">get-file-buffer&lt;/span> &lt;span style="color:#5a2">&amp;#34;/Users/yanchunwei/project/myblog2022/content-org/emacs-essentials.org&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="loading-a-file-into-a-buffer-without-display-it">Loading a file into a buffer without display it&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">find-file-noselect&lt;/span> &lt;span style="color:#5a2">&amp;#34;xx.org&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="get-all-buffer-names">Get all buffer names&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">mapcar&lt;/span> &lt;span style="color:#000">#&amp;#39;buffer-name&lt;/span> (&lt;span style="color:#000">buffer-list&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="point">point&lt;/h3>
&lt;p>The &amp;ldquo;point&amp;rdquo; is the location of the cursor in the buffer.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">point&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">point-max&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">point-min&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="moving-the-point">Moving the point&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">goto-char&lt;/span> &lt;span style="color:#3af">1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">goto-char&lt;/span> (&lt;span style="color:#000">point-max&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">;; goto the begining of the buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">beginning-of-buffer&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">;; goto the end of the buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">end-of-buffer&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">forward-char&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">forward-char&lt;/span> &lt;span style="color:#3af">5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">forward-word&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">backward-word&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="preserving-the-point">Preserving the point&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">save-excursion&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">goto-char&lt;/span> (&lt;span style="color:#000">point-max&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">point&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="examining-buffer-text">Examining buffer text&lt;/h4>
&lt;p>To look at text in the buffer.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">char-after&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">char-after&lt;/span> (&lt;span style="color:#000">point&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">char-after&lt;/span> (&lt;span style="color:#000">point-min&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="the-thing">The Thing&lt;/h4>
&lt;p>The &lt;code>thing-at-point&lt;/code> function is very useful for grabbing the text at the point if it matches a particular type of &amp;ldquo;thing&amp;rdquo;.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">thing-at-point&lt;/span> &lt;span style="color:#5a2">&amp;#39;word&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">thing-at-point&lt;/span> &lt;span style="color:#5a2">&amp;#39;sentence&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">thing-at-point&lt;/span> &lt;span style="color:#5a2">&amp;#39;sentence&lt;/span> &lt;span style="color:#000">t&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="serching-for-text">Serching for text&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">search-forward&lt;/span> &lt;span style="color:#5a2">&amp;#34;thing&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="inserting-text">Inserting text&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">insert&lt;/span> &lt;span style="color:#5a2">&amp;#34;000&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">insert&lt;/span> &lt;span style="color:#5a2">&amp;#34;\n&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#34;This is&amp;#34;&lt;/span> &lt;span style="color:#5a2">?\s&lt;/span> &lt;span style="color:#5a2">?\n&lt;/span> &lt;span style="color:#5a2">&amp;#34;Sparta!&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="deleting-text">Deleting text&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">with-current-buffer&lt;/span> &lt;span style="color:#5a2">&amp;#34;.gitignore&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">delete-region&lt;/span> (&lt;span style="color:#000">point&lt;/span>) (&lt;span style="color:#000">point-max&lt;/span>)))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="saving-a-buffer">Saving a buffer&lt;/h4>
&lt;p>To save the contents of a buffer back to the file it is associated with&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">save-buffer&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="modern-libraries">Modern libraries&lt;/h2>
&lt;h3 id="ht-dot-el-for-hashtables">ht.el for hashtables&lt;/h3>
&lt;p>Reference &lt;a href="https://github.com/Wilfred/ht.el">ht.el&lt;/a> for more details.&lt;/p>
&lt;h4 id="creating-a-hash-table">creating a hash table&lt;/h4>
&lt;p>Create an empty hash table&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">let*&lt;/span> ((&lt;span style="color:#000">the-dic&lt;/span> (&lt;span style="color:#000">ht-create&lt;/span>)))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">the-dic&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Create a hash table with initial records&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">let*&lt;/span> ((&lt;span style="color:#000">the-dic&lt;/span> (&lt;span style="color:#000">ht&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#5a2">&amp;#34;name&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#34;Tom&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#5a2">&amp;#34;sex&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#39;male&lt;/span>))))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">the-dic&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="accessing-the-hash-table">accessing the hash table&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">let*&lt;/span> ((&lt;span style="color:#000">the-dic&lt;/span> (&lt;span style="color:#000">ht&lt;/span> (&lt;span style="color:#5a2">&amp;#34;name&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#34;Tom&amp;#34;&lt;/span>) (&lt;span style="color:#5a2">&amp;#34;sex&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#39;male&lt;/span>))))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic">;; get a record&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic">;; returns &amp;#34;Tom&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">ht-get&lt;/span> &lt;span style="color:#000">the-dic&lt;/span> &lt;span style="color:#5a2">&amp;#34;name&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="iterating-over-the-hash-table">Iterating over the hash table&lt;/h4>
&lt;p>Readonly mapping:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">let*&lt;/span> ((&lt;span style="color:#000">the-dic&lt;/span> (&lt;span style="color:#000">ht&lt;/span> (&lt;span style="color:#5a2">&amp;#34;name&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#34;Tom&amp;#34;&lt;/span>) (&lt;span style="color:#5a2">&amp;#34;sex&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#39;male&lt;/span>) (&lt;span style="color:#5a2">&amp;#34;age&amp;#34;&lt;/span> &lt;span style="color:#3af">18&lt;/span>))))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">ht-map&lt;/span> (&lt;span style="color:#000">lambda&lt;/span> (&lt;span style="color:#000">key&lt;/span> &lt;span style="color:#000">value&lt;/span>) (&lt;span style="color:#000">message&lt;/span> &lt;span style="color:#5a2">&amp;#34;%S: %S&amp;#34;&lt;/span> &lt;span style="color:#000">key&lt;/span> &lt;span style="color:#000">value&lt;/span>)) &lt;span style="color:#000">the-dic&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Mutable mapping:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-emacs-lisp" data-lang="emacs-lisp">&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#000">let*&lt;/span> ((&lt;span style="color:#000">the-dic&lt;/span> (&lt;span style="color:#000">ht&lt;/span> (&lt;span style="color:#5a2">&amp;#34;name&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#34;Tom&amp;#34;&lt;/span>) (&lt;span style="color:#5a2">&amp;#34;sex&amp;#34;&lt;/span> &lt;span style="color:#5a2">&amp;#39;male&lt;/span>) (&lt;span style="color:#5a2">&amp;#34;age&amp;#34;&lt;/span> &lt;span style="color:#3af">18&lt;/span>))))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">ht-map&lt;/span> (&lt;span style="color:#000">lambda&lt;/span> (&lt;span style="color:#000">key&lt;/span> &lt;span style="color:#000">value&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic">;; modify the value if is string&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">setf&lt;/span> &lt;span style="color:#000">value&lt;/span> (&lt;span style="color:#000">if&lt;/span> (&lt;span style="color:#000">stringp&lt;/span> &lt;span style="color:#000">value&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> (&lt;span style="color:#000">concat&lt;/span> &lt;span style="color:#5a2">&amp;#34;modified &amp;#34;&lt;/span> &lt;span style="color:#000">value&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">value&lt;/span>))) &lt;span style="color:#000">the-dic&lt;/span>))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>